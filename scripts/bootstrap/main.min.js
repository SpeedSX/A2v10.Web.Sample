"use strict";!function(){window.app={modules:{},components:{},templates:{},nextToken:function(){return""+currentToken++}},window.require=require,window.component=function(name,noerror){if(name in app.components)return app.components[name];if(noerror)return{};throw new Error('component "'+name+'" not found')},window.template=function(name,noerror){if(name in app.templates)return app.templates[name];if(noerror)return{};throw new Error('template "'+name+'" not found')},window.define=function(args,factory){let exports={default:void 0};return factory(require,exports),exports.default};let rootElem=document.querySelector("meta[name=rootUrl]");function require(module,noerror){if(module in app.modules){let am=app.modules[module];return"function"==typeof am&&(am=am(),app.modules[module]=am),am}if(noerror)return null;throw new Error('module "'+module+'" not found')}window.$$rootUrl=rootElem&&rootElem.content||"";let currentToken=1603}(),app.modules["std:locale"]=function(){return window.$$locale},function(elem){elem.closest=elem.closest||function(css){let node=this;for(;node;){if(node.matches(css))return node;node=node.parentElement}return null},elem.scrollIntoViewCheck=elem.scrollIntoViewCheck||function(){let el=this,elRect=el.getBoundingClientRect(),pElem=el.parentElement;for(;pElem&&!(pElem.offsetHeight<pElem.scrollHeight);)pElem=pElem.parentElement;if(!pElem)return;let parentRect=pElem.getBoundingClientRect();(elRect.top<parentRect.top||elRect.bottom>parentRect.bottom)&&el.scrollIntoView({block:"nearest"})}}(Element.prototype),function(date){date.isZero=date.isZero||function(){let td=new Date(0,0,1,0,0,0,0);return td.setHours(0,-td.getTimezoneOffset(),0,0),this.getTime()===td.getTime()}}(Date.prototype),app.modules["std:platform"]={set:function(target,prop,value){Vue.set(target,prop,value)},defer:function(func){Vue.nextTick(func)},print:function(){window.print()},File,performance},app.modules["std:eventBus"]=new Vue({}),app.modules["std:utils"]=function(){const locale=require("std:locale"),platform=require("std:platform"),dateLocale=locale.$Locale,numLocale=locale.$Locale,dateOptsDate={timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"},dateOptsTime={timeZone:"UTC",hour:"2-digit",minute:"2-digit"},formatDate=new Intl.DateTimeFormat(dateLocale,dateOptsDate).format,formatTime=new Intl.DateTimeFormat(dateLocale,dateOptsTime).format,currencyFormat=new Intl.NumberFormat(numLocale,{minimumFractionDigits:2,maximumFractionDigits:6,useGrouping:!0}).format,numberFormat=new Intl.NumberFormat(numLocale,{minimumFractionDigits:0,maximumFractionDigits:6,useGrouping:!0}).format,utcdatRegEx=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$/;let numFormatCache={};return{isArray:Array.isArray,isFunction,isDefined,isObject,isObjectExact,isDate,isString,isNumber,isBoolean:function(value){return"boolean"==typeof value},isPromise:function(v){return isDefined(v)&&isFunction(v.then)&&isFunction(v.catch)},toString:function(obj){if(!isDefined(obj))return"";if(null===obj)return"";if(isObject(obj))return toJson(obj);return""+obj},defaultValue:function(type){switch(type){case void 0:return;case Number:return 0;case String:return"";case Boolean:return!1;case Date:return dateZero();case Object:return null;default:if("function"==typeof type)return null;throw new Error("There is no default value for type "+type)}},notBlank:function(val){if(!val)return!1;if(isDate(val))return!dateIsZero(val);switch(typeof val){case"string":return""!==val;case"date":return!1;case"object":if("$id"in val)return!!val.$id}return""!==(val||"")},toJson,fromJson:JSON.parse,isPrimitiveCtor:function(ctor){return ctor===String||ctor===Number||ctor===Boolean||ctor===Date||ctor===platform.File||ctor===Object},isDateCtor:function(ctor){return ctor===Date},isEmptyObject:function(obj){return!obj||0===Object.keys(obj).length&&obj.constructor===Object},defineProperty:function(trg,prop,get,set){Object.defineProperty(trg,prop,{enumerable:!0,configurable:!0,get})},eval:function(obj,path,dataType,opts,skipFormat){let r=simpleEval(obj,path);if(skipFormat)return r;return isDate(r)?format(r,dataType):isObject(r)?toJson(r):format(r,dataType,opts)},simpleEval,format,toNumber,parse:function(obj,dataType){switch(dataType){case"Currency":case"Number":return toNumber(obj);case"Date":return dateParse(obj)}return obj},getStringId:function(obj){if(!obj)return"0";if(isNumber(obj))return obj;if(isObjectExact(obj)){if("$id"in obj)return obj.$id||0;if("Id"in obj)return obj.Id||0;console.error("Id or @id not found in object")}return"0"},isEqual:function(o1,o2){if(o1===o2)return!0;if(isDate(o1)&&isDate(o2))return o1.getTime()===o2.getTime();if(isObjectExact(o1)&&isObjectExact(o2))return JSON.stringify(o1)===JSON.stringify(o2);return!1},date:{today:dateToday,now:function(second){let td=new Date,sec=second?td.getSeconds():0;return new Date(Date.UTC(td.getFullYear(),td.getMonth(),td.getDate(),td.getHours(),td.getMinutes(),sec,0))},zero:dateZero,parse:dateParse,tryParse:function(str){if(!str)return dateZero();if(isDate(str))return str;if(utcdatRegEx.test(str))return new Date(str);let dt;dt=8===str.length?new Date(+str.substring(0,4),+str.substring(4,6)-1,+str.substring(6,8),0,0,0,0):str.startsWith('"\\/"')?new Date(str.substring(4,str.length-4)):new Date(str);if(!isNaN(dt.getTime()))return new Date(Date.UTC(dt.getFullYear(),dt.getMonth(),dt.getDate(),0,0,0,0));return str},equal:dateEqual,isZero:dateIsZero,formatDate,format:formatDate,add:function(dt,nm,unit){if(!isDate(dt))return null;var du=0;switch(unit){case"year":return new Date(Date.UTC(dt.getFullYear()+nm,dt.getMonth(),dt.getDate(),0,0,0,0));case"month":let newMonth=dt.getMonth()+nm,day=dt.getDate();var ldm=new Date(Date.UTC(dt.getFullYear(),newMonth+1,0,0,0)).getDate();return day>ldm&&(day=ldm),new Date(Date.UTC(dt.getFullYear(),newMonth,day,0,0,0));case"day":du=864e5;break;case"hour":du=36e5;break;case"minute":du=6e4;break;case"second":du=1e3;break;default:throw new Error("Invalid unit value for utils.date.add")}return new Date(dt.getTime()+nm*du)},diff:function(unit,d1,d2){d1.getTime()>d2.getTime()&&([d1,d2]=[d2,d1]);switch(unit){case"second":return(d2-d1)/1e3;case"minute":return+((d2-d1)/1e3/60).toFixed(0);case"month":let delta=0;if(d2.getDate()<d1.getDate()&&(delta=-1),d1.getFullYear()===d2.getFullYear())return d2.getMonth()-d1.getMonth()+delta;let month=0,year=d1.getFullYear();for(;year<d2.getFullYear();){let day=d2.getDate(),dayOfMonth=endOfMonth(new Date(year+1,d1.getMonth(),1,0,0,0,0)).getDate();day>dayOfMonth&&(day=dayOfMonth),d1=new Date(year+1,d1.getMonth(),day,0,0,0,0),year=d1.getFullYear(),month+=12}return month+=d2.getMonth()-d1.getMonth(),month+delta;case"day":let du=864e5;return Math.floor((d2-d1)/du);case"year":let dy=new Date(d1.getFullYear(),d2.getMonth(),d2.getDate(),d2.getHours(),d2.getMinutes(),d2.getSeconds(),d2.getMilliseconds())<d1?d2>d1?-1:0:d2<d1?1:0;return d2.getFullYear()-d1.getFullYear()+dy}throw new Error("Invalid unit value for utils.date.diff")},create:dateCreate,compare:function(d1,d2){if(!isDate(d1)||!isDate(d2))return null;let t1=d1.getTime(),t2=d2.getTime();return t1-t2},endOfMonth,minDate:dateCreate(1901,1,1),maxDate:dateCreate(2999,12,31),fromDays:function(days){return new Date(Date.UTC(1900,0,days,0,0,0,0))},parseTime:function(str){let seg=(str=str||"").split(/[^\d]/).filter(x=>x);if(0===seg.length)return new Date(1970,0,1,0,0,0,0);1===seg.length&&seg.push("0");let h=Math.min(+seg[0],23),m=Math.min(+seg[1],59);return new Date(1970,0,1,h,m,0,0)}},text:{contains:textContains,containsText:function(obj,props,probe){if(!probe)return!0;if(!obj)return!1;for(let v of props.split(","))if(textContains(obj[v],probe))return!0;return!1},sanitize:function(text){return(""+text||"").replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"")},splitPath:function(path){let propIx=path.lastIndexOf(".");return{obj:path.substring(0,propIx),prop:path.substring(propIx+1)}},capitalize,maxChars:function(text,length){return(text=""+text||"").length<length?text:text.substring(0,length-1)+"…"},equalNoCase:function(s1,s2){return(s1||"").toLowerCase()===(s2||"").toLowerCase()},applyFilters:function(filters,value){if(!filters||!filters.length)return value;if(!value)return value;value=""+value;for(let f of filters)switch(f){case"trim":value=value.trim();break;case"upper":value=value.toUpperCase();break;case"lower":value=value.toLowerCase();break;case"barcode":value=toLatin(value)}return value}},currency:{round:function(n,digits){if(isNaN(n))return Nan;isDefined(digits)||(digits=2);let m=!1;n<0&&(n=-n,m=!0);let r=Number(Math.round(n.toFixed(12)+"e"+digits)+"e-"+digits);return m?-r:r},format:currencyFormat},func:{curry:function(fn,...args){return(..._arg)=>fn(...args,..._arg)},debounce,defPropertyGet:function(trg,prop,get){Object.defineProperty(trg,prop,{enumerable:!0,configurable:!0,get})}},debounce,model:{propFromPath:function(path){if(!path)return"";let propIx=path.lastIndexOf(".");return path.substring(propIx+1)}}};function isFunction(value){return"function"==typeof value}function isDefined(value){return void 0!==value}function isObject(value){return null!==value&&"object"==typeof value}function isDate(value){return value instanceof Date}function isString(value){return"string"==typeof value}function isNumber(value){return"number"==typeof value}function isObjectExact(value){return isObject(value)&&!Array.isArray(value)}function toJson(data){return JSON.stringify(data,(function(key,value){if(!dateIsZero(this[key]))return"$"===key[0]||"_"===key[0]?void 0:value}),2)}function simpleEval(obj,path){if(!path||!obj)return"";let ps=(path||"").split("."),r=obj;for(let i=0;i<ps.length;i++){let pi=ps[i];if(!(pi in r))throw new Error(`Property '${pi}' not found in ${r.constructor.name} object`);r=r[ps[i]]}return r}function pad2(num){return num<10?"0"+num:""+num}function formatNumber(num,format){if(!format)return numberFormat(num);if(numFormatCache[format])return numFormatCache[format](num);let fmt=format.match(/^([#][,\s])?(#*)?(0*)?\.?(0*)?(#*)?$/);if(!fmt)return console.error(`Invalid number format: '${format}'`),num;function getlen(x){return x?x.length:0}let useGrp=!!fmt[1],fi0=(getlen(fmt[2]),getlen(fmt[3])),fp0=getlen(fmt[4]),fph=getlen(fmt[5]),formatFunc=Intl.NumberFormat(numLocale,{minimumFractionDigits:fp0,maximumFractionDigits:fp0+fph,minimumIntegerDigits:fi0,useGrouping:useGrp}).format;return numFormatCache[format]=formatFunc,formatFunc(num)}function formatDateWithFormat(date,format){if(!format)return formatDate(date);switch(format){case"MMMM yyyy":return capitalize(date.toLocaleDateString(locale.$Locale,{month:"long",year:"numeric"}));default:console.error("invalid date format: "+format)}return formatDate(date)}function format(obj,dataType,opts){if(opts=opts||{},!dataType)return obj;if(!isDefined(obj))return"";switch(dataType){case"DateTime":return isDate(obj)?dateIsZero(obj)?"":opts.format?formatDateWithFormat(obj,opts.format):formatDate(obj)+" "+formatTime(obj):(console.error(`Invalid Date for utils.format (${obj})`),obj);case"Date":return isString(obj)&&(obj=function(str){try{let dt=new Date(str);return dt.setUTCHours(0,0,0,0),dt}catch(err){return str}}(obj)),isDate(obj)?dateIsZero(obj)?"":opts.format?formatDateWithFormat(obj,opts.format):formatDate(obj):(console.error(`Invalid Date for utils.format (${obj})`),obj);case"DateUrl":return dateIsZero(obj)?"":isDate(d1=obj)&&(0!==d1.getUTCHours()||0!==d1.getUTCMinutes()&&0!==d1.getUTCSeconds())?obj.toISOString():""+obj.getFullYear()+pad2(obj.getMonth()+1)+pad2(obj.getDate());case"Time":return isDate(obj)?dateIsZero(obj)?"":formatTime(obj):(console.error(`Invalid Date for utils.format (${obj})`),obj);case"Period":return obj.format?obj.format("Date"):(console.error(`Invalid Period for utils.format (${obj})`),obj);case"Currency":return isNumber(obj)||(obj=toNumber(obj)),opts.hideZeros&&0===obj?"":opts.format?formatNumber(obj,opts.format):currencyFormat(obj);case"Number":return isNumber(obj)||(obj=toNumber(obj)),opts.hideZeros&&0===obj?"":formatNumber(obj,opts.format);default:console.error(`Invalid DataType for utils.format (${dataType})`)}var d1;return obj}function toNumber(val){return isString(val)&&(val=val.replace(/\s/g,"").replace(",",".")),isFinite(val)?+val:0}function dateToday(){let td=new Date;return new Date(Date.UTC(td.getFullYear(),td.getMonth(),td.getDate(),0,0,0,0))}function dateZero(){return new Date(Date.UTC(0,0,1,0,0,0,0))}function dateParse(str,yearCutOff){if(str=str||"",utcdatRegEx.test(str))return new Date(str);if(!str)return dateZero();let today=dateToday(),seg=str.split(/[^\d]/).filter(x=>x);if(1===seg.length)if(8===seg[0].length){let x=seg[0];seg=[],seg.push(x.substring(0,2)),seg.push(x.substring(2,4)),seg.push(x.substring(4))}else seg.push(""+(today.getMonth()+1)),seg.push(""+today.getFullYear());else 2===seg.length&&seg.push(""+today.getFullYear());let cutOffYear=function(year){let yco=yearCutOff||"+10";return year<=(yco.startsWith("+")||yco.startsWith("-")?today.getFullYear()%100+parseInt(yco,10):+yco%100)?"20":"19"},td=new Date(Date.UTC(+function(y){switch((y=""+y).length){case 1:y=cutOffYear(y)+"0"+y;break;case 2:y=cutOffYear(y)+y;break;case 4:break;default:y=today.getFullYear()}return+y}(seg[2]),+((seg[1]?seg[1]:1)-1),+seg[0],0,0,0,0));return isNaN(td.getDate())?dateZero():td}function dateEqual(d1,d2){return d1.getFullYear()===d2.getFullYear()&&d1.getMonth()===d2.getMonth()&&d1.getDate()===d2.getDate()}function dateIsZero(d1){return!!isDate(d1)&&dateEqual(d1,dateZero())}function endOfMonth(dt){return new Date(Date.UTC(dt.getFullYear(),dt.getMonth()+1,0,0,0,0))}function dateCreate(year,month,day){return new Date(Date.UTC(year,month-1,day,0,0,0,0))}function capitalize(text){return text?text.charAt(0).toUpperCase()+text.slice(1):""}function toLatin(v){v=v.toUpperCase();let tbl={Й:"Q",Ц:"W",У:"E",К:"R",Е:"T",Н:"Y",Г:"U",Ш:"I",Щ:"O",З:"P",Х:"[",Ъ:"]",Ї:"]",Ф:"A",Ы:"S",В:"D",А:"F",П:"G",Р:"H",О:"J",Л:"K",Д:"L",І:"S",Ж:":",Э:'"',Є:'"',Я:"Z",Ч:"X",С:"C",М:"V",И:"B",Т:"N",Ь:"M",Б:"<",Ю:">"},r="";for(let i=0;i<v.length;i++){let ch=tbl[v[i]];r+=ch||v[i]}return r}function textContains(text,probe){return!probe||!!text&&-1!==(text||"").toString().toLowerCase().indexOf(probe.toLowerCase())}function debounce(fn,timeout){let timerId=null;return function(){clearTimeout(timerId),timerId=setTimeout(()=>{fn.call()},timeout)}}},app.modules["std:period"]=function(){const utils=require("std:utils"),date=utils.date,locale=window.$$locale;function TPeriod(source){source&&"From"in source&&(source.From||source.To)?(this.From=date.tryParse(source.From),this.To=date.tryParse(source.To)):(this.From=date.minDate,this.To=date.maxDate),Object.defineProperty(this,"Name",{enumerable:!0,get(){return this.format("Date")}})}return TPeriod.prototype.assign=function(v){return isPeriod(v)?(this.From=v.From,this.To=v.To):null===v.From&&null===v.To?(this.From=date.minDate,this.To=date.maxDate):(this.From=date.tryParse(v.From),this.To=date.tryParse(v.To)),this.normalize(),this},TPeriod.prototype.equal=function(p){return date.equal(this.From,p.From)&&date.equal(this.To,p.To)},TPeriod.prototype.fromUrl=function(v){if(utils.isObject(v)&&"From"in v)return this.From=date.tryParse(v.From),this.To=date.tryParse(v.To),this.normalize(),this;let px=(v||"").split("-");if("all"===px[0].toLowerCase())return this.From=date.minDate,this.To=date.maxDate,this;let df=px[0],dt=px.length>1?px[1]:px[0];return this.From=date.tryParse(df),this.To=date.tryParse(dt),this},TPeriod.prototype.isAllData=function(){return this.From.getTime()===date.minDate.getTime()&&this.To.getTime()===date.maxDate.getTime()},TPeriod.prototype.format=function(dataType){if(this.isAllData())return"DateUrl"===dataType?"All":locale.$AllPeriodData;let from=this.From,to=this.To;return from.getTime()===to.getTime()?utils.format(from,dataType):"DateUrl"===dataType?utils.format(from,dataType)+"-"+utils.format(to,dataType):utils.format(from,dataType)+" - "+(utils.format(to,dataType)||"???")},TPeriod.prototype.text=function(showCustom){if(this.isAllData())return locale.$AllPeriodData;let menu=predefined(!1);for(let mi of menu){let np=createPeriod(mi.key);if(this.equal(np))return mi.name}if(showCustom)return locale.$CustomPeriod;let from=this.From,to=this.To;return utils.format(from,"Date")+" - "+(utils.format(to,"Date")||"???")},TPeriod.prototype.in=function(dt){let t=dt.getTime(),zd=utils.date.zero().getTime();if(this.From.getTime()!==zd&&this.To.getTime()!==zd)return t>=this.From.getTime()&&t<=this.To.getTime()},TPeriod.prototype.normalize=function(){return this.From.getTime()>this.To.getTime()&&([this.From,this.To]=[this.To,this.From]),this},TPeriod.prototype.set=function(from,to){return this.From=from,this.To=to,this.normalize()},TPeriod.prototype.setFrom=function(from){return this.From=from,this.To.getTime()<this.From.getTime()&&(this.To=this.From),this},TPeriod.prototype.setTo=function(to){return this.To=to,this.From.getTime()>this.To.getTime()&&(this.From=this.To),this},TPeriod.prototype.toJson=function(){return JSON.stringify(this)},{isPeriod,like:function(obj){return!!obj&&(2===Object.getOwnPropertyNames(obj).length&&!(!obj.hasOwnProperty("From")||!obj.hasOwnProperty("To")))},constructor:TPeriod,zero:zeroPeriod,all:function(){return createPeriod("allData")},create:createPeriod,predefined};function isPeriod(value){return value instanceof TPeriod}function zeroPeriod(){return new TPeriod}function predefined(showAll){let menu=[{name:locale.$Today,key:"today"},{name:locale.$Yesterday,key:"yesterday"},{name:locale.$Last7Days,key:"last7"},{name:locale.$CurrMonth,key:"currMonth"},{name:locale.$PrevMonth,key:"prevMonth"},{name:locale.$CurrQuart,key:"currQuart"},{name:locale.$PrevQuart,key:"prevQuart"},{name:locale.$CurrYear,key:"currYear"},{name:locale.$PrevYear,key:"prevYear"}];return showAll&&menu.push({name:locale.$AllPeriodData,key:"allData"}),menu}function createPeriod(key,from,to){let today=date.today(),p=zeroPeriod();switch(key){case"today":p.set(today,today);break;case"yesterday":let yesterday=date.add(today,-1,"day");p.set(yesterday,yesterday);break;case"last7":let last7=date.add(today,-6,"day");p.set(last7,today);break;case"last30":let last30=date.add(today,-29,"day");p.set(last30,today);break;case"startMonth":let d1=date.create(today.getFullYear(),today.getMonth()+1,1);p.set(d1,today);break;case"prevMonth":{let d1=date.create(today.getFullYear(),today.getMonth(),1),d2=date.create(today.getFullYear(),today.getMonth()+1,1);p.set(d1,date.add(d2,-1,"day"))}break;case"currMonth":{let d1=date.create(today.getFullYear(),today.getMonth()+1,1),d2=date.create(today.getFullYear(),today.getMonth()+2,1);p.set(d1,date.add(d2,-1,"day"))}break;case"startQuart":{let m=3*Math.floor(today.getMonth()/3),d1=date.create(today.getFullYear(),m+1,1);p.set(d1,today)}break;case"currQuart":{let year=today.getFullYear(),q=Math.floor(today.getMonth()/3),m1=3*q,m2=3*(q+1),d1=date.create(year,m1+1,1),d2=date.add(date.create(year,m2+1,1),-1,"day");p.set(d1,d2)}break;case"prevQuart":{let year=today.getFullYear(),q=Math.floor(today.getMonth()/3)-1;q<0&&(year-=1,q=3);let m1=3*q,m2=3*(q+1),d1=date.create(year,m1+1,1),d2=date.add(date.create(year,m2+1,1),-1,"day");p.set(d1,d2)}break;case"startYear":let dy1=date.create(today.getFullYear(),1,1);p.set(dy1,today);break;case"currYear":{let dy1=date.create(today.getFullYear(),1,1),dy2=date.create(today.getFullYear(),12,31);p.set(dy1,dy2)}break;case"prevYear":{let dy1=date.create(today.getFullYear()-1,1,1),dy2=date.create(today.getFullYear()-1,12,31);p.set(dy1,dy2)}break;case"allData":p.set(date.minDate,date.maxDate);break;case"custom":p.set(from,to);break;default:console.error("invalid menu key: "+key)}return p}},app.modules["std:url"]=function(){const utils=require("std:utils"),period=require("std:period");return{combine,makeQueryString,parseQueryString,normalizeRoot:function(path){let root=window.$$rootUrl;return root&&path.startsWith(root)?path.substring(root.length):path},idChangedOnly:function(newUrl,oldUrl){let n1=(newUrl||"").split("?")[0],o1=(oldUrl||"").split("?")[0],ns=n1.split("/"),os=o1.split("/");if(ns.length!==os.length)return!1;function isNewPathArr(arr){let ai=arr[arr.length-1];return"new"===ai||"0"===ai}if(isNewPathArr(os)&&!isNewPathArr(ns)&&ns.slice(0,ns.length-1).join("/")===os.slice(0,os.length-1).join("/"))return!0;return!1},idOrCopyChanged:function(newUrl,oldUrl){let n1=(newUrl||"").split("?")[0],o1=(oldUrl||"").split("?")[0],ns=n1.split("/"),os=o1.split("/");if(ns.length!==os.length)return!1;if(ns.pop(),os.pop(),"edit"===ns.pop()&&"copy"===os.pop())return ns.join("/")===os.join("/");return!1},makeBaseUrl:function(url){let x=(url||"").split("/"),len=x.length;return len>=6?x.slice(2,len-2).join("/"):url},parseUrlAndQuery,replaceUrlQuery:function(url,query){url||(url=window.location.pathname+window.location.search);let pu=parseUrlAndQuery(url,query);return pu.url+makeQueryString(pu.query)},createUrlForNavigate:function(url,data){let urlId=data||"new",qs="";utils.isDefined(urlId.$id)?urlId=urlId.$id:utils.isObjectExact(urlId)&&(urlId=data.Id,delete data.Id,qs=makeQueryString(data),utils.isDefined(urlId)||(urlId="new"));url.endsWith("new")&&"new"===urlId&&(urlId="");return combine(url,urlId)+qs},firstUrl:"",encodeUrl:encodeURIComponent,helpHref:function(path){let helpUrlElem=document.querySelector("meta[name=helpUrl]");if(!helpUrlElem||!helpUrlElem.content)return console.warn("help url is not specified"),"";return helpUrlElem.content+(path||"")},replaceSegment:function(url,id,action){let parts=url.split("/");isDialogPath(url)?(parts.pop(),id&&parts.push(id)):(action&&parts.pop(),id&&parts.pop(),action&&parts.push(action),id&&parts.push(id));return parts.join("/")},removeFirstSlash:function(url){return url&&url.startsWith&&url.startsWith("/")?url.substring(1):url},isNewPath:function(url){return!!(url=url.split("?")[0])&&(-1!==url.indexOf("/new")||!(!isDialogPath(url)||!url.endsWith("/0")))}};function normalize(elem){return(elem=(elem=""+elem||"").replace(/\\/g,"/")).startsWith("/")&&(elem=elem.substring(1)),elem.endsWith("/")&&(elem=elem.substring(0,elem.length-1)),elem}function combine(...args){return"/"+args.map(normalize).filter(x=>!!x).join("/")}function toUrl(obj){return utils.isDefined(obj)&&null!==obj?utils.isDate(obj)?utils.format(obj,"DateUrl"):period.isPeriod(obj)?obj.format("DateUrl"):utils.isObjectExact(obj)?"Object"===obj.constructor.name?(utils.isDefined(obj.Id)||console.error("Id is not defined for Filter object"),""+(obj.Id||"")):(utils.isDefined(obj.$id)||console.error("$id is not defined for "+obj.constructor.name),""+(obj.$id||"0")):""+obj:""}function makeQueryString(obj){if(!obj)return"";if(!utils.isObjectExact(obj))return"";let esc=encodeURIComponent,query=Object.keys(obj).filter(k=>!k.startsWith("_")&&!k.startsWith("$")&&!function(obj){if(!obj)return!0;let objUrl=toUrl(obj);return!objUrl||"0"===objUrl}(obj[k])).map(k=>esc(k)+"="+esc(toUrl(obj[k]))).join("&");return query?"?"+query:""}function parseQueryString(str){var obj={};return str.replace(/\??([^=&]+)=([^&]*)/g,(function(m,key,value){obj[decodeURIComponent(key)]=""+decodeURIComponent(value)})),obj}function parseUrlAndQuery(url,querySrc){let query={};for(let p in querySrc)p.startsWith("_")||p.startsWith("$")||(query[p]=toUrl(querySrc[p]));let rv={url,query};if(-1!==url.indexOf("?")){let a=url.split("?");rv.url=a[0],rv.query=Object.assign({},parseQueryString(a[1]),query)}return rv}function isDialogPath(url){return url.startsWith("/_dialog/")}},app.modules["std:http"]=function(){const eventBus=require("std:eventBus"),urlTools=require("std:url");return{get:function(url,raw){return doRequest("GET",url,null,raw)},post:function(url,data,raw,skipEvents){return doRequest("POST",url,data,raw,skipEvents)},load:function(url,selector,baseUrl){if(selector){let fc=selector.firstElementChild;if(fc&&fc.__vue__){let ve=fc.__vue__;ve.$destroy(),ve.$el.remove(),ve.$el=null,fc.__vue__=null}selector.innerHTML=""}return new Promise((function(resolve,reject){eventBus.$emit("beginLoad"),doRequest("GET",url).then((function(html){if(html.startsWith("<!DOCTYPE"))return void window.location.assign("/");let rdoc=(new DOMParser).parseFromString(html,"text/html"),srcElem=rdoc.body.firstElementChild,elemId=srcElem.id||null;if(selector.innerHTML=srcElem?srcElem.outerHTML:"",elemId&&!document.getElementById(elemId))return selector.innerHTML="",void resolve(!1);for(let i=0;i<rdoc.scripts.length;i++){let s=rdoc.scripts[i];if("text/javascript"===s.type){let newScript=document.createElement("script");s.src?newScript.src=s.src:newScript.text=s.text,document.body.appendChild(newScript).parentNode.removeChild(newScript)}}if(selector.firstElementChild&&selector.firstElementChild.__vue__){let fec=selector.firstElementChild,ve=fec.__vue__;if(ve.$data.__baseUrl__=baseUrl||urlTools.normalizeRoot(url),ve.$data.__baseQuery__=urlTools.parseUrlAndQuery(url).query,fec.classList.contains("modal")){let dca=fec.getAttribute("data-controller-attr");dca&&eventBus.$emit("modalSetAttribites",dca,ve)}}rdoc.body.remove(),resolve(!0),eventBus.$emit("endLoad")})).catch((function(error){reject(error),eventBus.$emit("endLoad")}))}))},upload:async function(url,data){eventBus.$emit("beginRequest",url);try{var response=await fetch(url,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:data});let ct=response.headers.get("content-type")||"";switch(response.status){case 200:return ct.startsWith("application/json")?await response.json():await response.text();case 255:let txt=response.statusText;throw ct.startsWith("text/")&&(txt=await response.text()),txt}}catch(err){throw err}finally{eventBus.$emit("endRequest",url)}},localpost:async function(command,data){let url="http://127.0.0.1:64031/"+command,response=await fetch(url,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/plain","Content-Type":"text/plain"},body:data});if(200==response.status){return(response.headers.get("content-type")||"").startsWith("application/json")?await response.json():await response.text()}throw 255==response.status&&await response.text()||response.statusText}};async function doRequest(method,url,data,raw,skipEvents){skipEvents||eventBus.$emit("beginRequest",url);try{var response=await fetch(url,{method,mode:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json, text/html"},body:data});let ct=response.headers.get("content-type")||"";switch(response.status){case 200:return raw?await response.blob():ct.startsWith("application/json")?await response.json():await response.text();case 255:let txt=response.statusText;throw ct.startsWith("text/")&&(txt=await response.text()),txt;case 473:if("Unauthorized"===response.statusText)throw setTimeout(()=>{window.location.assign("/")},10),"__blank__";break;default:throw response.statusText}}catch(err){throw err}finally{skipEvents||eventBus.$emit("endRequest",url)}}},function(){const eventBus=require("std:eventBus"),urlTools=require("std:url"),titleStore={};function setTitle(to){to.title&&(document.title=to.title,titleStore[to.url]=to.title)}function normalizedRoute(){let path=window.location.pathname;return urlTools.normalizeRoot(path)}const store=new Vuex.Store({strict:!0,state:{route:normalizedRoute(),query:urlTools.parseQueryString(window.location.search)},getters:{seg0:state=>state.route.split("/")[1],seg1:state=>state.route.split("/")[2],len:state=>state.route.split("/").length,url:state=>state.route,query:state=>state.query,route:state=>{let sr=state.route.split("/");return{len:sr.length,seg0:sr[1],seg1:sr[2]}},baseUrl:state=>state.route+urlTools.makeQueryString(state.query),search:state=>urlTools.makeQueryString(state.query)},mutations:{navigate:function(state,to){let root=window.$$rootUrl,oldUrl=root+state.route+urlTools.makeQueryString(state.query);state.route=to.url.toLowerCase(),state.query=Object.assign({},to.query);let newUrl=root+state.route+urlTools.makeQueryString(to.query),h=window.history;setTitle(to),h.replaceState(oldUrl,null,oldUrl),h.pushState(oldUrl,null,newUrl)},query:function(state,query){let root=window.$$rootUrl;state.query=Object.assign({},query);let newUrl=root+state.route+urlTools.makeQueryString(state.query);window.history.replaceState(null,null,newUrl)},setquery:function(state,query){let root=window.$$rootUrl,oldUrl=root+this.getters.baseUrl;state.query=Object.assign({},state.query,query);let newUrl=root+this.getters.baseUrl;newUrl!==oldUrl&&(window.history.replaceState(null,null,newUrl),eventBus.$emit("queryChange",state.query))},popstate:function(state){state.route=normalizedRoute(),state.query=urlTools.parseQueryString(window.location.search),state.route in titleStore&&(document.title=titleStore[state.route])},setstate:function(state,to){window.history.replaceState(null,null,window.$$rootUrl+to.url),state.route=normalizedRoute(),state.query=urlTools.parseQueryString(window.location.search),setTitle(to)},setnewid:function(state,to){let root=window.$$rootUrl,oldRoute=state.route,newRoute=urlTools.replaceSegment(oldRoute,to.id,to.action);state.route=newRoute;let newUrl=root+newRoute+urlTools.makeQueryString(state.query);window.history.replaceState(null,null,newUrl)},close:function(state){function navigateBack(){window.close()}if(window.history.length>1){let oldUrl=window.location.pathname;window.history.back(),setTimeout(()=>{window.location.pathname===oldUrl&&navigateBack()},300)}else navigateBack()}}});function replaceUrlSearch(url,search){return url.split("?")[0]+(search||"")}store.parseQueryString=urlTools.parseQueryString,store.makeQueryString=urlTools.makeQueryString,store.replaceUrlSearch=replaceUrlSearch,store.replaceUrlQuery=function(url,query){return replaceUrlSearch(url,urlTools.makeQueryString(query))},store.makeBackUrl=function(url){let urlArr=url.split("/");return 5===urlArr.length?urlArr.slice(0,3).join("/"):4===url.length?urlArr.slice(0,2).join("/"):url},app.components["std:store"]=store}(),function(){const http=require("std:http"),urlTools=require("std:url"),eventBus=require("std:eventBus"),utils=require("std:utils");function _destroyElement(el){let fc=el.firstElementChild;if(!fc)return;let vue=fc.__vue__;vue&&!vue.$marker&&(vue=vue.$parent),vue&&vue.$marker()&&vue.$destroy(),el.__vue__=null}Vue.component("include",{template:'<div :class="implClass"></div>',props:{src:String,cssClass:String,needReload:Boolean,insideDialog:Boolean,done:Function},data:()=>({loading:!0,currentUrl:"",_needReload:!0}),methods:{loaded(ok){this.loading=!1,this.insideDialog&&eventBus.$emit("modalCreated",this),this.done&&this.done()},requery(){this.currentUrl&&(this.__destroy(),http.load(this.currentUrl,this.$el).then(this.loaded).catch(this.error))},__destroy(){_destroyElement(this.$el)},modalRequery(){this.insideDialog&&setTimeout(()=>{this.requery()},1)},error(msg){if(msg=msg instanceof Error?msg.message:msg||"",this.insideDialog&&eventBus.$emit("modalClose",!1),0===msg.indexOf("UI:")){let dlgData={promise:null,data:{message:msg.substring(3).replace("\\n","\n"),style:"alert"}};eventBus.$emit("confirm",dlgData)}else alert(msg)}},computed:{implClass(){return`include ${this.cssClass||""} ${this.loading?"loading":""}`}},mounted(){this.src&&(this.currentUrl=this.src,http.load(this.src,this.$el).then(this.loaded).catch(this.error))},destroyed(){this.__destroy()},watch:{src:function(newUrl,oldUrl){this.insideDialog||newUrl.split("?")[0]===oldUrl.split("?")[0]||urlTools.idChangedOnly(newUrl,oldUrl)||urlTools.idOrCopyChanged(newUrl,oldUrl)?this.currentUrl=newUrl:(this.loading=!0,this.currentUrl=newUrl,this.__destroy(),http.load(newUrl,this.$el).then(this.loaded).catch(this.error))},needReload(val){val&&this.requery()}}}),Vue.component("a2-include",{template:'<div class="a2-include"></div>',props:{source:String,arg:void 0,dat:void 0},data:()=>({needLoad:0}),methods:{__destroy(){_destroyElement(this.$el)},loaded(){},makeUrl(){let arg=this.arg||"0",url=urlTools.combine("_page",this.source,arg);return this.dat&&(url+=urlTools.makeQueryString(this.dat)),url},load(){let url=this.makeUrl();this.__destroy(),http.load(url,this.$el).then(this.loaded).catch(this.error)}},watch:{source(newVal,oldVal){utils.isEqual(newVal,oldVal)||(this.needLoad+=1)},arg(newVal,oldVal){utils.isEqual(newVal,oldVal)||(this.needLoad+=1)},dat(newVal,oldVal){utils.isEqual(newVal,oldVal)||(this.needLoad+=1)},needLoad(){this.load()}},mounted(){this.source&&(this.currentUrl=this.makeUrl(this.source),http.load(this.currentUrl,this.$el).then(this.loaded).catch(this.error))},destroyed(){this.__destroy()}})}(),app.modules["std:modelInfo"]=function(){const period=require("std:period");return{copyfromQuery:function(mi,q){if(!mi)return;let psq={PageSize:q.pageSize,Offset:q.offset,SortDir:q.dir,SortOrder:q.order,GroupBy:q.group};for(let p in psq)mi[p]=psq[p];if(mi.Filter)for(let p in mi.Filter)mi.Filter[p]=q[p]},get:function(mi){if(!mi)return;let x={pageSize:mi.PageSize,offset:mi.Offset,dir:mi.SortDir,order:mi.SortOrder,group:mi.GroupBy};if(mi.Filter)for(let p in mi.Filter)x[p]=mi.Filter[p];return x},reconcile,reconcileAll,setModelInfoForRoot:function(elem){elem.$createModelInfo=createElemModelInfo,elem._setModelInfo_=setRootModelInfo,elem._findRootModelInfo=findRootModelInfo},setModelInfo:function(root,info,rawData){root.__modelInfo=info||{PageSize:20};let mi=rawData.$ModelInfo;if(!mi)return;reconcileAll(mi);for(let p in mi)root[p].$ModelInfo=checkPeriod(mi[p])}};function reconcile(mi){if(mi&&mi.Filter)for(let p in mi.Filter){let fv=mi.Filter[p];if("string"==typeof fv&&fv.startsWith('"\\/"')){let dx=new Date(fv.substring(4,fv.length-4));mi.Filter[p]=dx}}}function reconcileAll(m){if(m)for(let p in m)reconcile(m[p])}function checkPeriod(obj){let f=obj.Filter;if(!f)return obj;if(!("Period"in f))return obj;let p=f.Period;return period.like(p)&&(f.Period=new period.constructor(p)),obj}function setModelInfoFilter(prop,val){period.isPeriod(val)?this.Filter[prop].assign(val):this.Filter[prop]=val}function setRootModelInfo(elem,data){if(data.$ModelInfo)for(let p in data.$ModelInfo)return elem||(elem=this[p]),elem.$ModelInfo=checkPeriod(data.$ModelInfo[p]),elem.$ModelInfo.$setFilter=setModelInfoFilter,elem.$ModelInfo}function createElemModelInfo(elem,raw){return elem.$ModelInfo||(elem.$ModelInfo=checkPeriod(raw),elem.$ModelInfo.$setFilter=setModelInfoFilter),elem.$ModelInfo}function findRootModelInfo(){for(let p in this._meta_.props){let x=this[p];if(x.$ModelInfo)return x.$ModelInfo}return null}},app.modules["std:mask"]=function(){return{getMasked,getUnmasked:function(mask,value){let str="";for(let i=0;i<mask.length;i++){let mc=mask[i],ch=value[i];if(!isSpaceChar(mc))if(isMaskChar(mc)){if(!ch||"_"===ch)return"";str+=ch}else str+=mc}return str},mountElement,unmountElement,setMask:function(el,mask){if(!el)return;mask?el.__opts?(el.__opts.mask=mask,el.value=getMasked(mask,"")):(mountElement(el,mask),el.value=getMasked(mask,"")):(unmountElement(el,mask),el.value="")}};function isMaskChar(ch){return"#"===ch||"@"===ch}function isSpaceChar(ch){return-1!=="- ()".indexOf(ch)}function getMasked(mask,value){let str="",j=0;for(let i=0;i<mask.length;i++){let mc=mask[i],ch=value[j];mc===ch?(str+=ch,j++):isMaskChar(mc)?(str+=ch||"_",j++):str+=mc}return str}function mountElement(el,mask){el&&(el.__opts={mask},el.addEventListener("keydown",keydownHandler,!1),el.addEventListener("blur",blurHandler,!1),el.addEventListener("focus",focusHandler,!1),el.addEventListener("paste",pasteHandler,!1))}function unmountElement(el,mask){el&&(delete el.__opts,el.removeEventListener("keydown",keydownHandler),el.removeEventListener("blur",blurHandler),el.removeEventListener("focus",focusHandler),el.removeEventListener("paste",pasteHandler))}function getCaretPosition(input){return input&&void 0!==input.selectionStart?(input.selectionStart!==input.selectionEnd&&input.setSelectionRange(input.selectionStart,input.selectionStart),input.selectionStart):0}function fitCaret(mask,pos,fit){if(pos>=mask.length)return pos+1;if(isMaskChar(mask[pos]))return pos;if("r"===fit){for(let i=pos+1;i<mask.length;i++)if(isMaskChar(mask[i]))return i;return mask.length+1}if("l"===fit){for(let i=pos-1;i>=0;i--)if(isMaskChar(mask[i]))return i;return fitCaret(mask,0,"r")}throw new Error(`mask.fitCaret. Invalid fit value '${fit}'`)}function setCaretPosition(input,pos,fit){if(input&&0!==input.offsetWidth&&0!==input.offsetHeight&&input.setSelectionRange){pos=fitCaret(input.__opts.mask,pos,fit),input.setSelectionRange(pos,pos)}}function setRangeText(input,text,s,e){if(input.setRangeText)return void input.setRangeText(text,s,e);let val=input.value,r=val.substring(0,s);r+=text,r+=val.substring(e),input.value=r}function setCurrentChar(input,char){let pos=getCaretPosition(input),mask=input.__opts.mask;if(pos=fitCaret(mask,pos,"r"),function(mask,char){return"#"===mask&&(char>="0"&&char<="9"||"_"===char)}(mask[pos],char)){setRangeText(input,char,pos,pos+1);let np=fitCaret(mask,pos+1,"r");input.setSelectionRange(np,np)}}function keydownHandler(e){if(function(e,input){if(e.which>=112&&e.which<=123)return!0;if(16===e.which||17===e.which)return!0;if(e.which>=112&&e.which<=123)return!0;if(9===e.which)return!0;if(13===e.which)return fireChange(input),setTimeout(()=>{let d="l";input.value||(input.value=getMasked(input.__opts.mask,""),d="r"),setCaretPosition(input,"r"===d?0:32768,d)},10),!0;if(e.ctrlKey)switch(e.which){case 86:case 67:case 65:case 88:case 90:case 45:return!0}else if(e.shiftKey)switch(e.which){case 45:case 46:case 37:case 39:case 36:case 35:return!0}return!1}(e,this))return;let handled=!1;if(function(ev,input){if(46!==ev.which)return!1;let s=input.selectionStart,e=input.selectionEnd,l=input.value.length;return 0===s&&e===l&&(input.value=getMasked(input.__opts.mask,""),setCaretPosition(input,0,"r"),ev.preventDefault(),ev.stopPropagation(),!0)}(e,this))return;let pos=getCaretPosition(this),char=e.which;switch(229===char&&(char=e.target.value.charAt(e.target.selectionStart-1).charCodeAt()),char){case 37:setCaretPosition(this,pos-1,"l"),handled=!0;break;case 39:setCaretPosition(this,pos+1,"r"),handled=!0;break;case 38:case 40:case 33:case 34:handled=!0;break;case 36:setCaretPosition(this,0,"r"),handled=!0;break;case 35:setCaretPosition(this,this.__opts.mask.length,"l"),handled=!0;break;case 46:setCurrentChar(this,"_"),handled=!0;break;case 8:setCaretPosition(this,pos-1,"l"),setCurrentChar(this,"_"),setCaretPosition(this,pos-1,"l"),handled=!0;break;default:1===e.key.length&&setCurrentChar(this,e.key),handled=!0}handled&&(e.preventDefault(),e.stopPropagation())}function blurHandler(e){fireChange(this)}function focusHandler(){this.value||(this.value=getMasked(this.__opts.mask,"")),setTimeout(()=>{setCaretPosition(this,0,"r")},10)}function pasteHandler(e){e.preventDefault();let dat=e.clipboardData.getData("text/plain");dat&&(this.value=function(mask,value){let str="",j=0;function nextValueChar(){let ch;for(;;){if(ch=value[j],!ch)return"_";if(j++,ch>="0"&&ch<="9")return ch}}let ch=nextValueChar();for(let i=0;i<mask.length;i++){let mc=mask[i];isSpaceChar(mc)?str+=mc:isMaskChar(mc)?(str+=ch,ch=nextValueChar()):(str+=mc,mc===ch&&(ch=nextValueChar()))}return str}(this.__opts.mask,dat))}function fireChange(input){var evt=document.createEvent("HTMLEvents");evt.initEvent("change",!1,!0),input.dispatchEvent(evt)}},app.modules["std:html"]=function(){return{getColumnsWidth:function(elem){let cols=elem.getElementsByTagName("col"),body=elem.querySelectorAll("tbody.col-shadow")[0];body.style.display="table-row-group";let cells=elem.querySelectorAll("tbody.col-shadow > tr > td"),len=Math.min(cols.length,cells.length);for(let i=0;i<len;i++){let w=cells[i].offsetWidth;cols[i].setAttribute("data-col-width",w)}body.style.display="none"},getRowHeight:function(elem,padding){let rows=elem.getElementsByTagName("tr");for(let r=0;r<rows.length;r++){let h=rows[r].offsetHeight-(padding||12);rows[r].setAttribute("data-row-height",h)}},downloadBlob:function(blob,fileName,format){let objUrl=URL.createObjectURL(blob),link=document.createElement("a");link.style="display:none",document.body.appendChild(link);let downloadFile=fileName||"file";"excel"===(format=(format||"").toLowerCase())?downloadFile+=".xlsx":"pdf"===format&&(downloadFile+=".pdf");link.download=downloadFile,link.href=objUrl,link.click(),document.body.removeChild(link),URL.revokeObjectURL(objUrl)},downloadUrl:function(url){let link=document.createElement("a");link.style="display:none",document.body.appendChild(link),link.href=url,link.setAttribute("download",""),link.click(),document.body.removeChild(link)},openUrl:function(url){let link=document.createElement("a");link.style="display:none",document.body.appendChild(link),link.href=url,link.setAttribute("target","_blank"),link.click(),document.body.removeChild(link)},printDirect:function(url){if(window.cefHost||navigator.userAgent.toLowerCase().indexOf("firefox")>-1)return void window.open(url);removePrintFrame();let frame=document.createElement("iframe");document.body.classList.add("waiting"),frame.id="print-direct-frame",frame.style.cssText="display:none;width:0;height:0;border:none;position:absolute;left:-10000,top:-100000",document.body.appendChild(frame),document.activeElement&&document.activeElement.blur();frame.setAttribute("src",url),frame.onload=function(ev){let cw=frame.contentWindow;if(cw.document.body){let finp=cw.document.createElement("input");finp.setAttribute("id","dummy-focus"),finp.cssText="width:0;height:0;border:none;position:absolute;left:-10000,top:-100000",cw.document.body.appendChild(finp),finp.focus(),cw.document.body.removeChild(finp)}document.body.classList.remove("waiting"),cw.print()}},removePrintFrame,updateDocTitle:function(title){if(document.title===title)return;document.title=title}};function removePrintFrame(){let frame=window.frames["print-direct-frame"];frame&&document.body.removeChild(frame)}},app.modules["std:validators"]=function(){const utils=require("std:utils"),eventBus=require("std:eventBus"),EMAIL_REGEXP=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,URL_REGEXP=/^[a-z][a-z\d.+-]*:\/*(?:[^:@]+(?::[^@]+)?@)?(?:[^\s:/?#]+|\[[a-f\d:]+\])(?::\d+)?(?:\/[^?#]*)?(?:\?[^#]*)?(?:#.*)?$/i;let validateMap=new WeakMap;return{validate:function(rules,item,val,du){let arr=[];utils.isArray(rules)?arr=rules:utils.isObject(rules)||utils.isFunction(rules)?arr.push(rules):utils.isString(rules)&&arr.push({valid:"notBlank",msg:rules});return function(rules,item,val,ff){let retval=[];return retval.pending=0,rules.forEach((function(rule){const sev=rule.severity||"error";if(!utils.isFunction(rule.applyIf)||rule.applyIf(item,val))if(utils.isString(rule))validateStd({valid:"notBlank"},val)||retval.push({msg:rule,severity:"error"});else if(utils.isFunction(rule)){let vr=rule(item,val);utils.isString(vr)&&vr?retval.push({msg:vr,severity:sev}):utils.isObject(vr)&&retval.push({msg:vr.msg,severity:vr.severity||sev})}else if(utils.isString(rule.valid))validateStd(rule,val)||retval.push({msg:rule.msg,severity:sev});else if(utils.isFunction(rule.valid)){if(rule.async){if(!validateMap.has(rule))return void addToWeak(rule,item,val);{let vmset=validateMap.get(rule);if(!vmset.has(item))return void addToWeak(rule,item,val);{let vmv=vmset.get(item);if(vmv.val===function(o1){if(utils.isObjectExact(o1)&&"$id"in o1)return o1.$id;return o1}(val))return void(vmv.result&&retval.push(vmv.result))}}}let vr=rule.valid(item,val);if(vr&&vr.then){if(retval.pending+=1,!rule.async)return void console.error("Async rules should be marked async:true");let valRes=addToWeak(rule,item,val);vr.then(result=>{let dm={severity:sev,msg:rule.msg},nu=!1;utils.isString(result)?(dm.msg=result,valRes.result=dm,retval.push(dm),nu=!0):result||(retval.push(dm),valRes.result=dm,nu=!0),item._root_._needValidate_=!0,nu&&ff&&ff(),retval.pending-=1,eventBus.$emit("pendingValidate")})}else utils.isString(vr)?retval.push({msg:vr,severity:sev}):utils.isObjectExact(vr)?retval.push({msg:vr.msg,severity:vr.severity}):vr||retval.push({msg:rule.msg,severity:sev})}else console.error("invalid valid element type for rule")})),retval}(arr,item,val,du)},removeWeak:function(){validateMap=new WeakMap}};function validateStd(rule,val){switch(rule.valid){case"notBlank":return utils.notBlank(val);case"email":return""===val||EMAIL_REGEXP.test(val);case"url":return""===val||URL_REGEXP.test(val);case"isTrue":return!0===val;case"regExp":return rule.regExp instanceof RegExp?""===val||rule.regExp.test(val):(console.error("rule.regExp is undefined or is not an regular expression"),!1)}return console.error(`invalid std rule: '${rule}'`),!0}function addToWeak(rule,item,val){let valMap;validateMap.has(rule)?valMap=validateMap.get(rule):(valMap=new WeakMap,validateMap.set(rule,valMap)),utils.isObjectExact(val)&&"$id"in val&&(val=val.$id);let valRes={val,result:null};return valMap.set(item,valRes),valRes}},app.modules["std:impl:array"]=function(){const utils=require("std:utils"),platform=require("std:platform"),defPropertyGet=utils.func.defPropertyGet;return{defineArray:function(arr){arr.$lock=!1,arr.$lockUpdate=function(lock){this.$lock=lock},arr.$new=function(src){let newElem=new this._elem_(src||null,this._path_+"[]",this);return newElem.__checked=!1,newElem},arr.$sum=function(fn){return this.reduce((a,c)=>a+fn(c),0)},arr.$find=function(fc,thisArg){for(let i=0;i<this.length;i++){let el=this[i];if(fc.call(thisArg,el,i,this))return el;if("$items"in el){let x=el.$items.$find(fc,thisArg);if(x)return x}}return null},arr.$sort=function(compare){return this.sort(compare),this.$renumberRows(),this},arr.$copy=function(src){if(this.$root.isReadOnly)return this;if(this.$empty(),utils.isArray(src))for(let i=0;i<src.length;i++)this.push(this.$new(src[i]));return this.$renumberRows(),this},arr.$select=function(elem){elem.$select()},arr.$clearSelected=function(){let sel=this.$selected;return sel?(sel.$selected=!1,emitSelect(this,null),this):this},function(arr){arr.$empty=function(){return this.$root.isReadOnly||(this.splice(0,this.length),"$RowCount"in this&&(this.$RowCount=0)),this},arr.$append=function(src){return this.$insert(src,"end")},arr.$prepend=function(src){return this.$insert(src,"start")},arr.$insert=function(src,to,current){const that=this;function append(src,select){let addingEvent=that._path_+"[].adding",newElem=that.$new(src);if(!1===that._root_.$emit(addingEvent,that,newElem))return null;let ix,len=that.length,ne=null;switch(to){case"end":len=that.push(newElem),ne=that[len-1];break;case"start":that.unshift(newElem),ne=that[0],len=1;break;case"above":ix=that.indexOf(current),that.splice(ix,0,newElem),ne=that[ix],len=ix+1;break;case"below":ix=that.indexOf(current)+1,that.splice(ix,0,newElem),ne=that[ix],len=ix+1}"$RowCount"in that&&(that.$RowCount+=1);let eventName=that._path_+"[].add";if(that._root_.$setDirty(!0),that._root_.$emit(eventName,that,ne,len-1),select&&(ne.$select(),emitSelect(that,ne)),"$rowNo"in newElem._meta_){let rowNoProp=newElem._meta_.$rowNo;for(let i=0;i<that.length;i++)that[i][rowNoProp]=i+1}if(that.$parent){let m=that.$parent._meta_;m.$hasChildren&&that._path_.endsWith("."+m.$items)&&(that.$parent[m.$hasChildren]=!0)}return ne}if(utils.isArray(src)){let ra=[],lastElem=null;return src.forEach((function(elem){lastElem=append(elem,!1),ra.push(lastElem)})),lastElem&&lastElem.$select(),ra}return append(src,!0)},arr.$renumberRows=function(){if(!this.length)return this;let item=this[0];if("$rowNo"in item._meta_){let rowNoProp=item._meta_.$rowNo;for(let i=0;i<this.length;i++)this[i][rowNoProp]=i+1}return this},arr.$remove=function(item){if(this.$root.isReadOnly)return this;if(!item)return this;let index=this.indexOf(item);if(-1===index)return this;this.splice(index,1),"$RowCount"in this&&(this.$RowCount-=1);let eventName=this._path_+"[].remove";if(this._root_.$setDirty(!0),this._root_.$emit(eventName,this,item,index),!this.length){if(this.$parent){let m=this.$parent._meta_;m.$hasChildren&&this._path_.endsWith("."+m.$items)&&(this.$parent[m.$hasChildren]=!1),m.$items&&this.$parent.$select()}return this}return index>=this.length&&(index-=1),this.$renumberRows(),this.length>index&&this[index].$select(),this}}(arr),function(arr){arr.$isLazy=function(){const meta=this.$parent._meta_;if(!meta.$lazy)return!1;let prop=utils.model.propFromPath(this._path_);return-1!==meta.$lazy.indexOf(prop)},arr.$resetLazy=function(){return this.$lock=!1,this.$empty(),this.$loaded&&(this.$loaded=!1),this},arr.$loadLazy=function(){if(this.$isLazy()&&!this.$lock)return new Promise((resolve,_)=>{if(!this.$vm)return;if(this.$loaded)return void resolve(this);if(!this.$parent)return void resolve(this);const meta=this.$parent._meta_;if(!meta.$lazy)return void resolve(this);let prop=utils.model.propFromPath(this._path_);-1!==meta.$lazy.indexOf(prop)?this.$vm.$loadLazy(this.$parent,prop).then(()=>resolve(this)):resolve(this)})},arr.$load=function(){this.$isLazy()&&platform.defer(()=>this.$loadLazy())}}(arr),function(arr){defPropertyGet(arr,"$selected",(function(){for(let x of this.$elements)if(x.$selected)return x})),defPropertyGet(arr,"$selectedIndex",(function(){for(let i=0;i<this.length;i++)if(this[i].$selected)return i;return-1})),defPropertyGet(arr,"$elements",(function(){return function*elems(arr){for(let i=0;i<arr.length;i++){let val=arr[i];yield val,val.$items&&(yield*elems(val.$items))}}(this)})),defPropertyGet(arr,"Count",(function(){return this.length})),defPropertyGet(arr,"$isEmpty",(function(){return!this.length})),defPropertyGet(arr,"$checked",(function(){return this.filter(el=>el.$checked)})),defPropertyGet(arr,"$hasSelected",(function(){return!!this.$selected}))}(arr),arr.Selected=function(propName){let sel=this.$selected;return sel?sel[propName]:null},arr.$reload=function(){return this.$lock=!1,this.$vm.$reload(this)}},defineArrayItemProto:function(elem){let proto=elem.prototype;proto.$remove=function(){this._parent_.$remove(this)},proto.$select=function(root){let arr=root||this._parent_,sel=arr.$selected;if(sel!==this&&(sel&&(sel.$selected=!1),this.$selected=!0,emitSelect(arr,this),this._meta_.$items)){let p=this._parent_._parent_;for(;p&&p&&p!==this.$root&&utils.isDefined(p.$expanded);)p.$expanded=!0,p=p._parent_._parent_}}}};function emitSelect(arr,item){let selectEvent=arr._path_+"[].select";arr._root_.$emit(selectEvent,arr,item)}},function(){const platform=require("std:platform"),validators=require("std:validators"),utils=require("std:utils"),log=require("std:log",!0),period=require("std:period"),mitool=require("std:modelInfo"),arrtool=require("std:impl:array");let __initialized__=!1;function loginfo(msg){log&&log.info(msg)}function logtime(msg,time){log&&log.time(msg,time)}function defHidden(obj,prop,value,writable){Object.defineProperty(obj,prop,{writable:writable||!1,enumerable:!1,configurable:!1,value})}function defHiddenGet(obj,prop,get){Object.defineProperty(obj,prop,{enumerable:!1,configurable:!1,get})}const defPropertyGet=utils.func.defPropertyGet;const propFromPath=utils.model.propFromPath;function defSource(trg,source,prop,parent){let propCtor=trg._meta_.props[prop];propCtor.type&&(propCtor=propCtor.type);let pathdot=trg._path_?trg._path_+".":"",shadow=trg._src_;if(source=source||{},utils.isObjectExact(propCtor)){if(!("type"in propCtor))throw new Error(`Invalid _meta_ for '${prop}'`);propCtor=propCtor.type}switch(propCtor){case Number:shadow[prop]=source[prop]||0;break;case String:shadow[prop]=source[prop]||"";break;case Boolean:shadow[prop]=source[prop]||!1;break;case Date:let srcval=source[prop]||null;shadow[prop]=srcval?new Date(srcval):utils.date.zero();break;case platform.File:case Object:shadow[prop]=null;break;case TMarker:let mp=trg._meta_.markerProps[prop];shadow[prop]=mp;break;case period.constructor:shadow[prop]=new propCtor(source[prop]);break;default:shadow[prop]=new propCtor(source[prop]||null,pathdot+prop,trg)}Object.defineProperty(trg,prop,{enumerable:!0,configurable:!0,get(){return this._src_[prop]},set(val){let eventWasFired=!1,skipDirty=prop.startsWith("$$"),ctor=this._meta_.props[prop],isjson=!1;if(ctor.type&&(isjson=!!ctor.json,ctor=ctor.type),isjson||(val=function(type,val){return utils.isDefined(val)||(val=utils.defaultValue(type)),type===Number?utils.toNumber(val):type===String?utils.toString(val):type!==Date||utils.isDate(val)?val:utils.date.parse(""+val)}(ctor,val)),val===this._src_[prop])return;let oldVal=this._src_[prop];if(!this._lockEvents_){let changingEvent=(this._path_||"Root")+"."+prop+".changing";if(!1===this._root_.$emit(changingEvent,this,val,oldVal,prop))return}if(this._src_[prop]&&this._src_[prop].$set?(this._src_[prop].$set(val),eventWasFired=!0):this._src_[prop]=val,skipDirty||this._root_.$setDirty(!0,this._path_,prop),this._lockEvents_)return;if(eventWasFired)return;let eventName=(this._path_||"Root")+"."+prop+".change";this._root_.$emit(eventName,this,val,oldVal,prop)}})}function TMarker(){}function createObjProperties(elem,ctor){let templ=elem._root_.$template;if(!templ)return;let props=templ._props_;if(!props)return;let objname=ctor.name;if(objname in props)for(let p in props[objname]){let propInfo=props[objname][p];utils.isPrimitiveCtor(propInfo)||(utils.isFunction(propInfo)?(loginfo(`create property: ${objname}.${p}`),Object.defineProperty(elem,p,{configurable:!1,enumerable:!0,get:propInfo})):utils.isObjectExact(propInfo)?propInfo.get&&(loginfo(`create property: ${objname}.${p}`),Object.defineProperty(elem,p,{configurable:!1,enumerable:!0,get:propInfo.get,set:propInfo.set})):alert("todo: invalid property type"))}}function seal(elem){if(Object.seal(elem),elem._meta_)for(let p in elem._meta_.props){let ctor=elem._meta_.props[p];if(ctor.type&&(ctor=ctor.type),utils.isPrimitiveCtor(ctor))continue;if(ctor===period.constructor)continue;let val=elem[p];utils.isArray(val)?val.forEach(itm=>seal(itm)):utils.isObjectExact(val)&&seal(val)}}function isReadOnly(){if("__modelInfo"in this){let mi=this.__modelInfo;if(utils.isDefined(mi.ReadOnly)&&mi.ReadOnly)return!0;if(utils.isDefined(mi.StateReadOnly)&&mi.StateReadOnly)return!0}return!1}function isStateReadOnly(){if("__modelInfo"in this){let mi=this.__modelInfo;if(utils.isDefined(mi.StateReadOnly)&&mi.StateReadOnly)return!0}return!1}function mainObject(){if("$main"in this._meta_){return this[this._meta_.$main]}return null}function isModelIsCopy(){if("__modelInfo"in this){let mi=this.__modelInfo;if(utils.isDefined(mi.Copy))return mi.Copy}return!1}function _BaseArray(length){let arr=new Array(length||0);return function(arr){defineCommonProps(arr),arrtool.defineArray(arr),arr.__fireChange__=function(opts){let root=this.$root,itm=this;"selected"===opts&&(itm=this.$selected),root.$emit(this._path_+"[].change",this,itm)}}(arr),arr}function defineCommonProps(obj){defHiddenGet(obj,"$host",(function(){return this._root_._host_})),defHiddenGet(obj,"$root",(function(){return this._root_})),defHiddenGet(obj,"$parent",(function(){return this._parent_})),defHiddenGet(obj,"$vm",(function(){return this._root_&&this._root_._host_?this._root_._host_.$viewModel:null})),defHiddenGet(obj,"$ctrl",(function(){return this._root_&&this._root_._host_?this._root_._host_.$ctrl:null})),defHiddenGet(obj,"$ready",(function(){return!this.$vm||!this.$vm.$isLoading})),obj.$isValid=function(props){return!0}}function emit(event,...arr){this._enableValidate_&&(this._needValidate_||(this._needValidate_=!0)),loginfo("emit: "+event);let templ=this.$template;if(!templ)return;let events=templ.events;if(events&&event in events){loginfo("handle: "+event);let rv=events[event].call(this,...arr);return!1===rv&&loginfo(event+" returns false"),rv}}function getDelegate(name){let tml=this.$template;return tml&&tml.delegates?name in tml.delegates?tml.delegates[name].bind(this.$root):void console.error(`Delegate "${name}" not found in the template`):(console.error("There are no delegates in the template"),null)}function canExecuteCommand(cmd,arg,opts){const tml=this.$template;if(!tml)return!1;if(!tml.commands)return!1;const cmdf=tml.commands[cmd];if(!cmdf)return!1;const optsCheckValid=opts&&!0===opts.validRequired,optsCheckRO=opts&&!0===opts.checkReadOnly;return!(opts&&!0===opts.checkArgument&&!arg)&&((!0!==cmdf.checkReadOnly&&!optsCheckRO||!this.$root.$readOnly)&&(!((!0===cmdf.validRequired||optsCheckValid)&&!this.$root.$valid)&&(utils.isFunction(cmdf.canExec)?cmdf.canExec.call(this,arg):utils.isBoolean(cmdf.canExec)?cmdf.canExec:!utils.isDefined(cmdf.canExec)||(console.error(cmd+".canExec should be a function"),!1))))}function executeCommand(cmd,arg,confirm,opts){try{this._root_._enableValidate_=!1;let vm=this.$vm;const tml=this.$template;if(!tml)return;if(!tml.commands)return;let cmdf=tml.commands[cmd];if(!cmdf)return void console.error(`Command "${cmd}" not found`);const optConfirm=cmdf.confirm||confirm,optSaveRequired=cmdf.saveRequired||opts&&opts.saveRequired;if((cmdf.validRequired||opts&&opts.validRequired)&&!vm.$data.$valid)return;if(utils.isFunction(cmdf.canExec)&&!cmdf.canExec.call(this,arg))return;let that=this;const doExec=function(){const realExec=function(){return utils.isFunction(cmdf)?cmdf.call(that,arg):utils.isFunction(cmdf.exec)?cmdf.exec.call(that,arg):void console.error($`There is no method 'exec' in command '${cmd}'`)};if(!optConfirm)return realExec();vm.$confirm(optConfirm).then(realExec)};if(!optSaveRequired||!vm.$isDirty)return doExec();vm.$save().then(doExec)}finally{this._root_._enableValidate_=!0,this._root_._needValidate_=!0}}function saveErrors(item,path,errors){if(item._errors_||errors)return!item._errors_&&errors&&(item._errors_={}),errors&&errors.length>0?item._errors_[path]=errors:path in item._errors_&&delete item._errors_[path],utils.isEmptyObject(item._errors_)&&(item._errors_=null),errors}function validate(item,path,val,ff){if(!item._root_._needValidate_)return item._errors_&&path in item._errors_?item._errors_[path]:null;return saveErrors(item,path,function(item,path,val,du){if(!item)return null;let tml=item._root_.$template;if(!tml)return null;var vals=tml.validators;if(!vals)return null;var elemvals=vals[path];return elemvals?validators.validate(elemvals,item,val,du):null}(item,path,val,ff))}function*enumData(root,path,name,index){if(index=index||"",!path)return void(yield{item:root,val:root[name],ix:index});let sp=path.split("."),currentData=root;for(let i=0;i<sp.length;i++){let last=i===sp.length-1,prop=sp[i];if(prop.endsWith("[]")){let pname=prop.substring(0,prop.length-2);pname in currentData||console.error(`Invalid validator key. Property '${pname}' not found in '${currentData.constructor.name}'`);let objto=currentData[pname];if(!objto)continue;for(let j=0;j<objto.length;j++){let arrItem=objto[j];if(last)yield{item:arrItem,val:arrItem[name],ix:index+":"+j};else{let newpath=sp.slice(i+1).join(".");yield*enumData(arrItem,newpath,name,index+":"+j)}}return}{prop in currentData||console.error(`Invalid Validator key. property '${prop}' not found in '${currentData.constructor.name}'`);let objto=currentData[prop];if(last)return void(objto&&(yield{item:objto,val:objto[name],ix:index}));currentData=objto}}}function validateOneElement(root,path,vals){if(!vals)return;let errs=[];for(let elem of function*(root,path){let ld=path.lastIndexOf("."),dp="",dn=path;-1!==ld&&(dp=path.substring(0,ld),dn=path.substring(ld+1)),yield*enumData(root,dp,dn,"")}(root,path)){let res=validators.validate(vals,elem.item,elem.val);saveErrors(elem.item,path,res),res&&res.length&&errs.push(...res)}return errs.length?errs:null}function forceValidateAll(){this._needValidate_=!0;var retArr=this._validateAll_(!1);return this._validateAll_(!0),retArr}function validateAll(force){var me=this;if(!me._host_)return;if(!me._needValidate_)return;me._needValidate_=!1,force&&validators.removeWeak();var startTime=platform.performance.now();let tml=me.$template;if(!tml)return;let vals=tml.validators;if(!vals)return;let allerrs=[];for(var val in vals){let err1=validateOneElement(me,val,vals[val]);err1&&allerrs.push({x:val,e:err1})}return logtime("validation time:",startTime),allerrs}function setDirty(val,path,prop){this.$root.$readOnly||path&&path.toLowerCase().startsWith("query")||function(root){let t=root.$template,opts=t&&t.options;return opts&&opts.noDirty}(this.$root)||path&&prop&&function(root,path){let t=root.$template;const opts=t&&t.options;if(!opts)return!1;const sd=opts.skipDirty;return!(!sd||!utils.isArray(sd))&&-1!==sd.indexOf(path)}(this.$root,`${path}.${prop}`)||(this.$dirty=val)}function empty(){return this.$set({}),this}function setElement(src){this.$root.isReadOnly||this.$merge(src)}function getMaxLength(prop){let m=this._meta_.props;if(!m)return;let x=m[prop];return utils.isObjectExact(x)?x.len:void 0}function isSkipMerge(root,prop){let t=root.$template,opts=t&&t.options,bo=opts&&opts.bindOnce;return!!bo&&-1!==bo.indexOf(prop)}function saveSelections(){let root=this,t=root.$template,opts=t&&t.options;if(!opts)return;let ps=opts.persistSelect;if(!ps||!ps.length)return;let result={};for(let p of ps){let arr=utils.simpleEval(root,p);if("$selected"in arr){let sel=arr.$selected;sel&&(result[p]=sel.$id)}}return result}function restoreSelections(sels){if(!sels)return;let root=this;for(let p in sels){let arr=utils.simpleEval(root,p),selId=sels[p];if("$find"in arr){let se=arr.$find(x=>x.$id===selId);se&&se.$select()}}}function merge(src,checkBindOnce,existsOnly){let oldId=this.$id__;try{for(var prop in null===src&&(src={}),this._root_._enableValidate_=!1,this._lockEvents_+=1,this._meta_.props){if(prop.startsWith("$$"))continue;if(checkBindOnce&&isSkipMerge(this._root_,prop))continue;let ctor=this._meta_.props[prop];ctor.type&&(ctor=ctor.type);let trg=this[prop];if(Array.isArray(trg)){if(trg.$loaded&&(trg.$loaded=!1),trg.$copy(src[prop]),"$RowCount"in trg){let rcProp=prop+".$RowCount";trg.$RowCount=rcProp in src&&src[rcProp]||0}}else if(utils.isDateCtor(ctor)){src[prop]?platform.set(this,prop,new Date(src[prop])):platform.set(this,prop,utils.date.zero())}else if(utils.isPrimitiveCtor(ctor))platform.set(this,prop,src[prop]);else{if(existsOnly&&!(prop in src))continue;let newsrc=new ctor(src[prop],prop,this);platform.set(this,prop,newsrc)}}}finally{this._root_._enableValidate_=!0,this._root_._needValidate_=!0,this._lockEvents_-=1}if(this.$parent._lockEvents_)return this;let newId=this.$id__,fireChange=!1;if(utils.isDefined(newId)&&utils.isDefined(oldId)&&(fireChange=newId!==oldId),fireChange){let eventName=this._path_+".change";this._root_.$emit(eventName,this.$parent,this,this,propFromPath(this._path_))}return this}function setRootRuntimeInfo(runtime){if(runtime&&runtime.$cross)for(let p in this){if(p.startsWith("$")||p.startsWith("_"))continue;let ta=this[p];if(ta._elem_&&ta.$cross)for(let x in runtime.$cross){if(ta._elem_.name!=x)continue;let t=ta.$cross,s=runtime.$cross[x];for(let p in t){let ta=t[p],sa=s[p];ta&&sa?ta.splice(0,ta.length,...sa):ta&&!sa&&ta.splice(0,ta.length)}}}}function destroyRoot(){this._host_.$viewModel=null,this._host_=null}app.modules["std:datamodel"]={createObject:function(elem,source,path,parent){const ctorname=elem.constructor.name;let startTime=null;"TRoot"===ctorname&&(startTime=platform.performance.now()),parent=parent||elem,defHidden(elem,"_src_",{}),defHidden(elem,"_path_",path||""),defHidden(elem,"_root_",parent._root_||parent),defHidden(elem,"_parent_",parent),defHidden(elem,"_errors_",null,!0),defHidden(elem,"_lockEvents_",0,!0),elem._uiprops_={};let hasTemplProps=!1;const templ=elem._root_.$template;templ&&!utils.isEmptyObject(templ._props_)&&(hasTemplProps=!0),hasTemplProps&&function(elem,ctor){const templ=elem._root_.$template;if(!templ)return;const props=templ._props_;if(!props)return;let objname=ctor.name;if(objname in props)for(let p in props[objname]){let propInfo=props[objname][p];utils.isPrimitiveCtor(propInfo)?(loginfo(`create scalar property: ${objname}.${p}`),elem._meta_.props[p]=propInfo):utils.isObjectExact(propInfo)&&(propInfo.get||(loginfo(`create object property: ${objname}.${p}`),elem._meta_.props[p]=TMarker,elem._meta_.markerProps||(elem._meta_.markerProps={}),elem._meta_.markerProps[p]=propInfo))}}(elem,elem.constructor);for(let propName in elem._meta_.props)defSource(elem,source,propName);hasTemplProps&&createObjProperties(elem,elem.constructor),path&&path.endsWith("]")&&(elem.$selected=!1),elem._meta_.$items&&(elem.$expanded=!1,elem.$collapsed=!1,elem.$level=0,function(elem){elem.$expand=function(){if(!this._meta_.$items)return null;if(this.$expanded)return null;this[this._meta_.$items];return this.$vm.$expand(this,this._meta_.$items,!0)},elem.$selectPath=async function(arr,cb){if(!arr.length)return null;let itemsProp=this._meta_.$items;if(!itemsProp)return null;let current=null;cb(this,arr[0])&&(current=this);for(let i=1;i<arr.length;i++){if(!current)return null;await current.$expand(),current=current[itemsProp].$find(itm=>cb(itm,arr[i]))}return current}}(elem)),elem.$lockEvents=function(){this._lockEvents_+=1},elem.$unlockEvents=function(){this._lockEvents_-=1},defHiddenGet(elem,"$eventsLocked",(function(){return this._lockEvents_>0})),defPropertyGet(elem,"$valid",(function(){if(this._root_._needValidate_&&this._root_._validateAll_(),this._errors_)return!1;for(var x in this){if("$"===x[0]||"_"===x[0])continue;let sx=this[x];if(utils.isArray(sx))for(let i=0;i<sx.length;i++){let ax=sx[i];if(utils.isObject(ax)&&"$valid"in ax&&!ax.$valid)return!1}else if(utils.isObject(sx)&&"$valid"in sx&&!sx.$valid)return!1}return!0})),defPropertyGet(elem,"$invalid",(function(){return!this.$valid})),elem.$errors=function(prop){if(!this)return null;let root=this._root_;if(!root)return null;if(!root._validate_)return null;let path=`${this._path_}.${prop}`,arr=root._validate_(this,path,this[prop]);return arr&&0===arr.length?null:arr},!0===elem._meta_.$group&&defPropertyGet(elem,"$groupName",(function(){if(!utils.isDefined(this.$level))return"#err#";const mi=this._root_.__modelInfo.Levels;if(mi){const levs=mi[this.constructor.name];if(levs&&this.$level<=levs.length)return this[levs[this.$level-1]]}return console.error("invalid data for $groupName"),"#err#"})),elem._meta_.$itemType&&(elem.$setProperty=function(prop,src){let itmPath=path+"."+prop,ne=new elem._meta_.$itemType(src,itmPath,elem);return platform.set(this,prop,ne),this._root_.$setDirty(!0),ne});let constructEvent=ctorname+".construct",_lastCaller=null,propForConstruct=path?propFromPath(path):"";if(elem._root_.$emit(constructEvent,elem,propForConstruct),elem._root_===elem){for(var m in elem._root_ctor_=elem.constructor,elem.$dirty=!1,elem._query_={},elem._meta_.props){let rcp=m+".$RowCount";if(source&&rcp in source){let rcv=source[rcp]||0;elem[m].$RowCount=rcv}}mitool.setModelInfoForRoot(elem),elem._setRuntimeInfo_=setRootRuntimeInfo,elem._saveSelections=saveSelections,elem._restoreSelections=restoreSelections,elem._enableValidate_=!0,elem._needValidate_=!1,elem._modelLoad_=caller=>{_lastCaller=caller,function(root){if(root.$template&&root.$template.defaults)for(let p in root.$template.defaults){let px=p.lastIndexOf(".");if(-1===px)continue;let path=p.substring(0,px),prop=p.substring(px+1);if(prop.endsWith("[]"))continue;let def=root.$template.defaults[p],obj=utils.simpleEval(root,path);obj.$isNew&&(utils.isFunction(def)?platform.set(obj,prop,def.call(root,obj,prop)):platform.set(obj,prop,def))}}(elem),elem._fireLoad_(),__initialized__=!0},elem._fireLoad_=()=>{platform.defer(()=>{let isRequery=elem.$vm.__isModalRequery();elem.$emit("Model.load",elem,_lastCaller,isRequery),elem._root_.$setDirty(!!elem._root_.$isCopy)})},elem._fireUnload_=()=>{elem.$emit("Model.unload",elem)},defHiddenGet(elem,"$readOnly",isReadOnly),defHiddenGet(elem,"$stateReadOnly",isStateReadOnly),defHiddenGet(elem,"$isCopy",isModelIsCopy),defHiddenGet(elem,"$mainObject",mainObject),elem._seal_=seal,elem._fireGlobalPeriodChanged_=period=>{elem.$emit("GlobalPeriod.change",elem,period)}}return startTime&&logtime("create root time:",startTime),elem},createArray:function(source,path,ctor,arrctor,parent){let arr=new _BaseArray(source?source.length:0),dotPath=path+"[]";defHidden(arr,"_elem_",ctor),defHidden(arr,"_path_",path),defHidden(arr,"_parent_",parent),defHidden(arr,"_root_",parent._root_||parent),defPropertyGet(arr,"$valid",(function(){if(this._errors_)return!1;for(var x of this)if(x._errors_)return!1;return!0})),defPropertyGet(arr,"$invalid",(function(){return!this.$valid})),ctor.prototype._meta_.$cross&&defPropertyGet(arr,"$cross",(function(){return ctor.prototype._meta_.$cross})),createObjProperties(arr,arrctor);let constructEvent=arrctor.name+".construct";if(arr._root_.$emit(constructEvent,arr),!source)return arr;for(let i=0;i<source.length;i++)arr[i]=new arr._elem_(source[i],dotPath,arr),arr[i].__checked=!1;return arr},defineObject:function(obj,meta,arrayItem){var elem;defHidden(obj.prototype,"_meta_",meta),obj.prototype.$merge=merge,obj.prototype.$empty=empty,obj.prototype.$set=setElement,obj.prototype.$maxLength=getMaxLength,defineCommonProps(obj.prototype),defHiddenGet(obj.prototype,"$isNew",(function(){return!this.$id})),defHiddenGet(obj.prototype,"$isEmpty",(function(){return!this.$id})),defHiddenGet(obj.prototype,"$id",(function(){let idName=this._meta_.$id;if(!idName){let tpname=this.constructor.name;throw new Error(tpname+" object does not have an Id property")}return this[idName]})),defHiddenGet(obj.prototype,"$id__",(function(){let idName=this._meta_.$id;if(idName)return this[idName]})),defHiddenGet(obj.prototype,"$name",(function(){let nameName=this._meta_.$name;if(!nameName){let tpname=this.constructor.name;throw new Error(tpname+" object does not have a Name property")}return this[nameName]})),arrayItem&&(elem=obj,arrtool.defineArrayItemProto(elem),Object.defineProperty(elem.prototype,"$checked",{enumerable:!0,configurable:!0,get(){return this.__checked},set(val){this.__checked=val;let arr=this.$parent,checkEvent=arr._path_+"[].check";arr._root_.$emit(checkEvent,arr,this)}})),meta.$hasChildren&&defHiddenGet(obj.prototype,"$hasChildren",(function(){let hcName=this._meta_.$hasChildren;if(hcName)return this[hcName]})),meta.$items&&defHiddenGet(obj.prototype,"$items",(function(){let itmsName=this._meta_.$items;if(itmsName)return this[itmsName]})),meta.$permissions&&defHiddenGet(obj.prototype,"$permissions",(function(){let permName=this._meta_.$permissions;if(permName){var perm=this[permName];if(this.$isNew&&0===perm){let mi=this.$ModelInfo;mi&&utils.isDefined(mi.Permissions)&&(perm=mi.Permissions)}return Object.freeze({canView:!!(1&perm),canEdit:!!(2&perm),canDelete:!!(4&perm),canApply:!!(8&perm),canUnapply:!!(16&perm)})}}))},implementRoot:function(root,template,ctors){if(root.prototype.$emit=emit,root.prototype.$setDirty=setDirty,root.prototype.$defer=platform.defer,root.prototype.$merge=merge,root.prototype.$template=template,root.prototype._exec_=executeCommand,root.prototype._canExec_=canExecuteCommand,root.prototype._delegate_=getDelegate,root.prototype._validate_=validate,root.prototype._validateAll_=validateAll,root.prototype.$forceValidate=forceValidateAll,root.prototype.$destroy=destroyRoot,!template)return;let xProp={};for(let p in template.properties){let px=p.split(".");if(2!==px.length){console.error(`invalid propery name '${p}'`);continue}let typeName=px[0],propName=px[1],pv=template.properties[p];typeName in xProp||(xProp[typeName]={}),xProp[typeName][propName]=pv}template._props_=xProp},setModelInfo:mitool.setModelInfo,enumData}}(),function(){let http=require("std:http");app.modules["std:dataservice"]={post:function(url,data,raw){return http.post(url,data,raw)},get:function(url){return http.get(url)}}}(),function(){const eventBus=require("std:eventBus"),utils=require("std:utils"),dataservice=require("std:dataservice"),urltools=require("std:url"),log=require("std:log",!0),locale=window.$$locale,mask=require("std:mask"),modelInfo=require("std:modelInfo"),platform=require("std:platform"),htmlTools=require("std:html",!0),store=component("std:store"),documentTitle=component("std:doctitle",!0);let __updateStartTime=0,__createStartTime=0;function __runDialog(url,arg,query,cb){return new Promise((function(resolve,reject){const dlgData={promise:null,data:arg,query,rd:!0};eventBus.$emit("modal",url,dlgData),dlgData.promise.then((function(result){cb(result),resolve(result)}))}))}function makeErrors(errs){let ra=[];for(let x of errs)for(let y of x.e)ra.push(y.msg);return ra.length?ra:null}function isPermissionsDisabled(opts,arg){if(opts&&opts.checkPermission&&utils.isObjectExact(arg)&&arg.$permissions){let perm=arg.$permissions,prop=opts.checkPermission;if(prop in perm){if(!perm[prop])return!0}else console.error(`invalid permssion name: '${prop}'`)}return!1}const base=Vue.extend({store,components:{"a2-document-title":documentTitle},data:()=>({__init__:!0,__baseUrl__:"",__baseQuery__:{},__requestsCount__:0,__lockQuery__:!0,__testId__:null}),computed:{$baseUrl(){return this.$data.__baseUrl__},$baseQuery(){return this.$data.__baseQuery__},$indirectUrl(){return this.$data.__modelInfo.__indirectUrl__||""},$query(){return this.$data._query_},$jsonQuery(){return utils.toJson(this.$data.Query)},$isDirty(){return this.$data.$dirty},$isPristine(){return!this.$data.$dirty},$isLoading(){return this.$data.__requestsCount__>0},$modelInfo(){return this.$data.__modelInfo},$canSave(){return this.$isDirty&&!this.$isLoading}},watch:{$jsonQuery(newData,oldData){this.$nextTick(()=>this.$reload())}},methods:{$marker:()=>!0,$exec(cmd,arg,confirm,opts){if(this.$isReadOnly(opts))return;if(this.$isLoading)return;if(isPermissionsDisabled(opts,arg))return void this.$alert(locale.$PermissionDenied);return this.$data._exec_(cmd,arg,confirm,opts)},$toJson:data=>utils.toJson(data),$maxChars:(text,length)=>utils.text.maxChars(text,length),$isReadOnly(opts){return opts&&opts.checkReadOnly&&this.$data.$readOnly},$execSelected(cmd,arg,confirm){if(this.$isLoading)return;let root=this.$data;utils.isArray(arg)?confirm?this.$confirm(confirm).then(()=>root._exec_(cmd,arg.$selected)):root._exec_(cmd,arg.$selected):console.error("Invalid argument for $execSelected")},$canExecute(cmd,arg,opts){if(this.$isReadOnly(opts))return!1;return this.$data._canExec_(cmd,arg,opts)},$setCurrentUrl(url){this.inDialog&&(url=urltools.combine("_dialog",url)),this.$data.__baseUrl__=url,eventBus.$emit("modalSetBase",url)},$save(opts){if(this.$data.$readOnly)return;if(!this.$data.$dirty)return;let mainObjectName=this.$data._meta_.$main,self=this;let url=`${window.$$rootUrl}/${require("std:routing").dataUrl()}/save`,urlToSave=this.$indirectUrl||this.$baseUrl;const isCopy=this.$data.$isCopy;if(!!opts&&opts.options&&opts.options.validRequired&&this.$data.$invalid){let errs=makeErrors(this.$data.$forceValidate());return void this.$alert(locale.$MakeValidFirst,void 0,errs)}self.$data.$emit("Model.beforeSave",self.$data);let saveSels=self.$data._saveSelections();return new Promise((function(resolve,reject){let jsonData=utils.toJson({baseUrl:urlToSave,data:self.$data}),wasNew=urltools.isNewPath(self.$baseUrl);dataservice.post(url,jsonData).then((function(data){if(self.__destroyed__)return;let dataToResolve,newId;if(self.$data.$merge(data,!0,!0),self.$data.$emit("Model.saved",self.$data),self.$data.$setDirty(!1),mainObjectName)dataToResolve=data[mainObjectName],newId=self.$data[mainObjectName].$id;else for(let p in data)if(dataToResolve=data[p],newId=self.$data[p].$id,dataToResolve)break;wasNew&&newId?(self.inDialog||self.$store.commit("setnewid",{id:newId}),self.$data.__baseUrl__=urltools.replaceSegment(self.$data.__baseUrl__,newId)):isCopy&&(self.inDialog||self.$store.commit("setnewid",{id:newId,action:"edit"}),self.$data.__baseUrl__=urltools.replaceSegment(self.$data.__baseUrl__,newId,"edit")),self.$data._restoreSelections(saveSels),resolve(dataToResolve);let toast=opts&&opts.toast?opts.toast:null;toast&&self.$toast(toast),self.$notifyOwner(newId,toast)})).catch((function(msg){self.$alertUi(msg)}))}))},$notifyOwner(id,toast){if(!window.opener)return;if(!window.$$token)return;let rq=window.opener.require;if(!rq)return;const bus=rq("std:eventBus");if(!bus)return;let dat={token:window.$$token.token,update:window.$$token.update,toast:toast||null,id};bus.$emit("childrenSaved",dat)},$invoke(cmd,data,base,opts){let self=this;let url=`${window.$$rootUrl}/${require("std:routing").dataUrl()}/invoke`,baseUrl=self.$indirectUrl||self.$baseUrl;return base&&(baseUrl=urltools.combine("_page",base,"index",0)),new Promise((function(resolve,reject){var jsonData=utils.toJson({cmd,baseUrl,data});dataservice.post(url,jsonData).then((function(data){if(!self.__destroyed__)if(utils.isObject(data))resolve(data);else{if(!utils.isString(data))throw new Error("Invalid response type for $invoke");resolve(data)}})).catch((function(msg){"__blank__"!==msg&&(opts&&opts.catchError?reject(msg):self.$alertUi(msg))}))}))},$asyncValid(cmd,data){const vm=this,cache=vm.__asyncCache__,djson=JSON.stringify(data);let val=cache[cmd];return val||(val={data:"",result:null},cache[cmd]=val),val.data===djson?val.result:(val.data=djson,new Promise((function(resolve,reject){vm.__destroyed__||Vue.nextTick(()=>{vm.$invoke(cmd,data).then(result=>{vm.__destroyed__||(val.result=result.Result.Value,resolve(val.result))})})})))},$reload(args){let self=this;if(utils.isArray(args)&&args.$isLazy()){let propIx=args._path_.lastIndexOf("."),prop=args._path_.substring(propIx+1);return args.$loaded=!1,self.$loadLazy(args.$parent,prop)}let url=`${window.$$rootUrl}/${require("std:routing").dataUrl()}/reload`,dat=self.$data,mi=args?modelInfo.get(args.$ModelInfo):null;if(!args&&!mi){let modInfo=this.$data._findRootModelInfo();modInfo&&(mi=modelInfo.get(modInfo))}let saveSels=dat._saveSelections();return new Promise((function(resolve,reject){let dataToQuery={baseUrl:urltools.replaceUrlQuery(self.$baseUrl,mi)};if(utils.isDefined(dat.Query)){dataToQuery.baseUrl=urltools.replaceUrlQuery(self.$baseUrl,dat.Query);let newUrl=urltools.replaceUrlQuery(null,dat.Query);window.history.replaceState(null,null,newUrl)}let jsonData=utils.toJson(dataToQuery);dataservice.post(url,jsonData).then((function(data){if(!self.__destroyed__){if(!utils.isObject(data))throw new Error("Invalid response type for $reload");dat.$merge(data,!0),modelInfo.reconcileAll(data.$ModelInfo),dat._setModelInfo_(void 0,data),dat._setRuntimeInfo_(data.$runtime),dat._fireLoad_(),dat._restoreSelections(saveSels),resolve(dat)}})).catch((function(msg){self.$alertUi(msg)}))}))},$requery(){this.inDialog?eventBus.$emit("modalRequery",this.$baseUrl):eventBus.$emit("requery")},$remove(item,confirm){this.$data.$readOnly||this.$isLoading||(confirm?this.$confirm(confirm).then(()=>item.$remove()):item.$remove())},$removeSelected(arr,confirm){if(utils.isArray(arr)||console.error("$removeSelected. The argument is not an array"),this.$data.$readOnly)return;let item=arr.$selected;item&&this.$remove(item,confirm)},$mailto(arg,subject){let href="mailto:"+arg;return subject&&(href+="?subject="+urltools.encodeUrl(subject)),href},$href:(url,data)=>urltools.createUrlForNavigate(url,data),$navigate(url,data,newWindow,update,opts){if(this.$isReadOnly(opts))return;eventBus.$emit("closeAllPopups");let urlToNavigate=urltools.createUrlForNavigate(url,data);if(!0===newWindow){let nwin=window.open(urlToNavigate,"_blank");nwin&&(nwin.$$token={token:this.__currentToken__,update})}else this.$store.commit("navigate",{url:urlToNavigate})},$navigateSimple(url,newWindow,update){if(!0===newWindow){let nwin=window.open(url,"_blank");nwin&&(nwin.$$token={token:this.__currentToken__,update})}else this.$store.commit("navigate",{url})},$navigateExternal(url,newWindow){!0===newWindow?window.open(url,"_blank"):window.location.assign(url)},$download(url){const root=window.$$rootUrl;url=urltools.combine("/file",url.replace(".","-")),window.location=root+url},$file(url,arg,opts){const root=window.$$rootUrl;let id=arg,token=void 0;arg&&utils.isObject(arg)&&(id=utils.getStringId(arg),arg._meta_&&arg._meta_.$token&&(token=arg[arg._meta_.$token]));let fileUrl=urltools.combine(root,"_file",url,id),qry={},action=(opts||{}).action;switch(token&&(qry.token=token),"download"==action&&(qry.export=1),fileUrl+=urltools.makeQueryString(qry),action){case"download":htmlTools.downloadUrl(fileUrl);break;case"print":htmlTools.printDirect(fileUrl);break;default:window.open(fileUrl,"_blank")}},$attachment(url,arg,opts){const root=window.$$rootUrl;let cmd=opts&&opts.export?"export":"show",id=arg,token=void 0;arg&&utils.isObject(arg)&&(id=utils.getStringId(arg),arg._meta_&&arg._meta_.$token&&(token=arg[arg._meta_.$token]));let attUrl=urltools.combine(root,"attachment",cmd,id),qry={base:url};token&&(qry.token=token),attUrl+=urltools.makeQueryString(qry),opts&&opts.newWindow?window.open(attUrl,"_blank"):window.location.assign(attUrl)},$eusign(baseurl,arg){window.$$rootUrl;var url;(url="/eusign/index",new Promise((function(resolve,reject){const dlgData={promise:null,data:arg,query:{base:baseurl},raw:!0};eventBus.$emit("modal",url,dlgData),dlgData.promise.then((function(result){cb(result),resolve(result)}))}))).then((function(resolve,reject){alert("promise resolved")}))},$dbRemove(elem,confirm,opts){if(!elem)return;if(isPermissionsDisabled(opts,elem))return void this.$alert(locale.$PermissionDenied);if(this.$isLoading)return;let id=elem.$id,lazy=!!elem.$parent.$isLazy&&elem.$parent.$isLazy(),root=window.$$rootUrl;const self=this;function dbRemove(){let postUrl=root+"/_data/dbRemove",jsonObj={baseUrl:self.$baseUrl,id};lazy&&(jsonObj.prop=function(path){let pos=path.lastIndexOf(".");if(-1!==pos)return path.substring(pos+1)}(elem.$parent._path_));let jsonData=utils.toJson(jsonObj);dataservice.post(postUrl,jsonData).then((function(data){self.__destroyed__||elem.$remove()})).catch((function(msg){self.$alertUi(msg)}))}confirm?this.$confirm(confirm).then((function(){dbRemove()})):dbRemove()},$dbRemoveSelected(arr,confirm,opts){if(this.$isLoading)return;let sel=arr.$selected;sel&&this.$dbRemove(sel,confirm,opts)},$openSelectedFrame(url,arr){url=url||"";let sel=arr.$selected;if(!sel)return;let urlToNavigate=urltools.createUrlForNavigate(url,sel.$id);eventBus.$emit("openframe",urlToNavigate)},$openSelected(url,arr,newwin,update){url=url||"";let sel=arr.$selected;if(sel){if(url.startsWith("{")){url=url.substring(1,url.length-1);let nUrl=utils.eval(sel,url);if(!nUrl)throw new Error(`Property '${url}' not found in ${sel.constructor.name} object`);url=nUrl}this.$navigate(url,sel.$id,newwin,update)}},$hasSelected(arr,opts){if(opts&&opts.validRequired){if(!this.$data.$valid)return!1}return arr&&!!arr.$selected},$hasChecked:arr=>arr&&arr.$checked&&arr.$checked.length,$sanitize:text=>utils.text.sanitize(text),$confirm(prms){utils.isString(prms)&&(prms={message:prms}),prms.style=prms.style||"confirm",prms.message=prms.message||prms.msg;let dlgData={promise:null,data:prms};return eventBus.$emit("confirm",dlgData),dlgData.promise},$focus(htmlid){let elem=document.querySelector("#"+htmlid);if(!elem)return;let ch=elem.querySelector("input, textarea, button, select");this.$defer(()=>{ch&&ch.focus?ch.focus():elem.focus&&elem.focus()})},$msg(msg,title,style){let prms={message:msg,title:title||locale.$Message,style:style||"info"};return this.$confirm(prms)},$alert(msg,title,list){if(utils.isObject(msg)&&!title&&!list){let prms=msg;msg=prms.message||prms.msg,title=prms.title,list=prms.list}let dlgData={promise:null,data:{message:msg,title,style:"alert",list}};return eventBus.$emit("confirm",dlgData),dlgData.promise},$alertUi(msg){msg instanceof Error?alert(msg.message):0===msg.indexOf("UI:")?this.$alert(msg.substring(3).replace("\\n","\n")):alert(msg)},$toast(toast,style){toast&&(utils.isString(toast)&&(toast={text:toast,style:style||"success"}),eventBus.$emit("toast",toast))},$showDialog(url,arg,query,opts){return this.$dialog("show",url,arg,query,opts)},$inlineOpen(id){eventBus.$emit("inlineDialog",{cmd:"open",id})},$inlineClose(id,result){eventBus.$emit("inlineDialog",{cmd:"close",id,result})},$dialog(command,url,arg,query,opts){if(this.$isReadOnly(opts))return;const that=this;function argIsNotAnArray(){if(!utils.isArray(arg))return console.error(`$dialog.${command}. The argument is not an array`),!0}function argIsNotAnObject(){if(!utils.isObjectExact(arg))return console.error(`$dialog.${command}. The argument is not an object`),!0}function doDialog(){if(isPermissionsDisabled(opts,arg))return void that.$alert(locale.$PermissionDenied);utils.isFunction(query)&&(query=query());let reloadAfter=opts&&opts.reloadAfter;switch(command){case"new":if(argIsNotAnArray())return;return __runDialog(url,0,query,result=>{let sel=arg.$selected;sel&&sel.$merge(result)});case"append":if(argIsNotAnArray())return;return __runDialog(url,0,query,result=>{arg.$append(result)});case"browse":return utils.isObject(arg)?__runDialog(url,arg,query,result=>{arg.$merge?arg.$merge(result):function(target,src){for(let p in target)target[p]=p in src?src[p]:void 0}(arg,result)}):void console.error(`$dialog.${command}. The argument is not an object`);case"edit-selected":if(argIsNotAnArray())return;if(!arg.$selected)return;return __runDialog(url,arg.$selected,query,result=>{arg.$selected.$merge(result),arg.__fireChange__("selected"),reloadAfter&&that.$reload()});case"show-selected":if(argIsNotAnArray())return;if(!arg.$selected)return;return __runDialog(url,arg.$selected,query,result=>{("reload"===result||reloadAfter)&&that.$reload()});case"edit":if(argIsNotAnObject())return;return __runDialog(url,arg,query,result=>{"reload"===result?that.$reload():arg.$merge&&utils.isObjectExact(result)&&(arg.$merge(result),reloadAfter&&that.$reload())});case"copy":if(argIsNotAnObject())return;let arr=arg.$parent;return __runDialog(url,arg,query,result=>{arr.$append(result),reloadAfter&&that.$reload()});default:return __runDialog(url,arg,query,r=>{reloadAfter&&that.$reload()})}}if(eventBus.$emit("closeAllPopups"),opts&&opts.validRequired&&root.$invalid)return void this.$alert(locale.$MakeValidFirst);let mo=this.$data.$mainObject;if(opts&&opts.saveRequired&&(this.$isDirty||mo&&mo.$isNew)){let dlgResult=null;return this.$save().then(()=>{dlgResult=doDialog()}),dlgResult}return doDialog()},$export(arg,url,dat,opts){if(this.$isLoading)return;const doExport=()=>{let id=arg||"0";arg&&utils.isObject(arg)&&(id=utils.getStringId(arg));const root=window.$$rootUrl;let newurl=url?urltools.combine("/_export",url,id):this.$baseUrl.replace("/_page/","/_export/");newurl=urltools.combine(root,newurl)+urltools.makeQueryString(dat),window.location=newurl};opts&&opts.saveRequired&&this.$isDirty?this.$save().then(()=>{doExport()}):doExport()},$exportTo(format,fileName){const root=window.$$rootUrl;let elem=this.$el.getElementsByClassName("sheet-page");if(!elem.length)return void console.error("element not found (.sheet-page)");var tbl=elem[0].getElementsByTagName("table");if(0==tbl.length)return void console.error("element not found (.sheet-page table)");if(tbl=tbl[0],htmlTools){htmlTools.getColumnsWidth(tbl);let padding=tbl.classList.contains("compact")?4:12;htmlTools.getRowHeight(tbl,padding)}let html="<table>"+tbl.innerHTML+"</table>",data={format,html,fileName,zoom:+window.devicePixelRatio.toFixed(2)};let url=`${root}/${require("std:routing").dataUrl()}/exportTo`;dataservice.post(url,utils.toJson(data),!0).then((function(blob){htmlTools&&htmlTools.downloadBlob(blob,fileName,format)})).catch((function(error){alert(error)}))},$report(rep,arg,opts,repBaseUrl,data){if(this.$isReadOnly(opts))return;if(this.$isLoading)return;let cmd="show",fmt="",viewer="report";opts&&(opts.export?(cmd="export",fmt=opts.format||""):opts.attach?cmd="attach":opts.print&&(cmd="print"),opts.viewer&&"show"===cmd&&(viewer=opts.viewer));const doReport=()=>{let id=arg;arg&&utils.isObject(arg)&&(id=utils.getStringId(arg));let url=`${window.$$rootUrl}/${viewer}/${cmd}/${id}`,reportUrl=urltools.removeFirstSlash(repBaseUrl)||this.$indirectUrl||this.$baseUrl,baseUrl=urltools.makeBaseUrl(reportUrl),qry=Object.assign({},{base:baseUrl,rep},data);if(fmt&&(qry.format=fmt),url+=urltools.makeQueryString(qry),opts)if(opts.export)window.location=url;else if(opts.print)htmlTools.printDirect(url);else{if(opts.attach)return;window.open(url,"_blank")}else window.open(url,"_blank")};opts&&opts.validRequired&&root.$invalid?this.$alert(locale.$MakeValidFirst):opts&&opts.saveRequired&&this.$isDirty?this.$save().then(()=>{doReport()}):doReport()},$modalSaveAndClose(result,opts){if(this.$isDirty){const root=this.$data;if(opts&&opts.validRequired&&root.$invalid){let errs=makeErrors(root.$forceValidate());return void this.$alert(locale.$MakeValidFirst,void 0,errs)}this.$save().then(result=>eventBus.$emit("modalClose",result))}else eventBus.$emit("modalClose",result)},$modalClose(result){eventBus.$emit("modalClose",result)},$setFilter(obj,prop,val){eventBus.$emit("setFilter",{source:obj,prop,value:val})},$modalSelect(array,opts){if("$selected"in array){if(opts&&opts.validRequired){if(!this.$data.$valid)return}this.$modalClose(array.$selected)}else console.error("Invalid array for $modalSelect")},$modalSelectChecked(array){if(!("$checked"in array))return void console.error("invalid array for $modalSelectChecked");let chArray=array.$checked;chArray.length>0&&this.$modalClose(chArray)},$saveAndClose(opts){this.$isDirty?this.$save(opts).then(()=>this.$close()):this.$close()},$close(){this.$saveModified()&&this.$store.commit("close")},$showHelp(path){window.open(this.$helpHref(path),"_blank")},$helpHref:path=>urltools.helpHref(path),$searchChange(){let newUrl=this.$store.replaceUrlSearch(this.$baseUrl);this.$data.__baseUrl__=newUrl,this.$reload()},$saveModified(message,title){if(!this.$isDirty)return!0;let self=this,dlg={message:message||locale.$ElementWasChanged,title:title||locale.$ConfirmClose,buttons:[{text:locale.$Save,result:"save"},{text:locale.$NotSave,result:"close"},{text:locale.$Cancel,result:!1}]};function closeImpl(result){self.inDialog?eventBus.$emit("modalClose",result):self.$close()}return this.$confirm(dlg).then((function(result){"close"===result?(self.$data.$setDirty(!1),closeImpl(!1)):"save"===result&&self.$save().then((function(saveResult){closeImpl(saveResult)}))})),!1},$format:(value,opts)=>opts?(utils.isString(opts)&&(opts={dataType:opts}),opts.format||opts.dataType||opts.mask?opts.mask?value?mask.getMasked(opts.mask,value):value:opts.dataType?utils.format(value,opts.dataType,{hideZeros:opts.hideZeros,format:opts.format}):opts.format&&-1!==opts.format.indexOf("{0}")?opts.format.replace("{0}",value):utils.isDate(value)&&opts.format?utils.format(value,"DateTime",{format:opts.format}):value:value):value,$getNegativeRedClass:value=>utils.isNumber(value)&&value<0?"negative-red":"",$expand(elem,propName,expval){let self=this,url=window.$$rootUrl+"/_data/expand";return new Promise((function(resolve,reject){let arr=elem[propName];if(utils.isDefined(expval)){if(elem.$expanded==expval)return void resolve(arr);platform.set(elem,"$expanded",expval)}if(arr.$loaded)return void resolve(arr);if(!utils.isDefined(elem.$hasChildren))return void resolve(arr);if(!elem.$hasChildren)return arr.$loaded=!0,void resolve(arr);let jsonData=utils.toJson({baseUrl:self.$baseUrl,id:elem.$id});dataservice.post(url,jsonData).then((function(data){if(self.__destroyed__)return;let srcArray=data[propName];if(arr.$empty(),srcArray)for(let el of srcArray)arr.push(arr.$new(el));resolve(arr)})).catch((function(msg){self.$alertUi(msg),reject(arr)})),arr.$loaded=!0}))},$loadLazy(elem,propName){const routing=require("std:routing");let self=this,url=`${window.$$rootUrl}/${routing.dataUrl()}/loadlazy`,selfMi=elem[propName].$ModelInfo,mi=(elem.$parent.$ModelInfo,modelInfo.get(selfMi)),newUrl=urltools.parseUrlAndQuery(self.$baseUrl,mi).url+urltools.makeQueryString(mi),jsonData=utils.toJson({baseUrl:newUrl,id:elem.$id,prop:propName});return new Promise((function(resolve,reject){let arr=elem[propName];arr.$loaded?resolve(arr):(dataservice.post(url,jsonData).then((function(data){if(!self.__destroyed__){if(propName in data){arr.$empty();for(let el of data[propName])arr.push(arr.$new(el));let rcName=propName+".$RowCount";rcName in data&&(arr.$RowCount=data[rcName]),data.$ModelInfo&&modelInfo.reconcile(data.$ModelInfo[propName]),arr._root_._setModelInfo_(arr,data)}resolve(arr)}})).catch((function(msg){self.$alertUi(msg)})),arr.$loaded=!0)}))},$delegate(name){return this.$data._delegate_(name)},$defer:platform.defer,$print:platform.print,$hasError(path){let err=this[utils.text.splitPath(path).obj]._errors_;if(!err)return!1;let arr=err[path];return arr&&arr.length},$errorMessage(path){let err=this[utils.text.splitPath(path).obj]._errors_;if(!err)return"";let arr=err[path];return arr&&arr.length?arr[0].msg:""},$getErrors(severity){let errs=this.$data.$forceValidate();if(!errs||!errs.length)return null;severity&&!utils.isArray(severity)&&(severity=[severity]);let result=[];for(let x of errs)for(let ix=0;ix<x.e.length;ix++){let y=x.e[ix];sev=y.severity,severity&&-1===severity.indexOf(sev)||result.push({path:x,msg:y.msg,severity:y.severity,index:ix})}var sev;return result.length?result:null},__beginRequest(){this.$data.__requestsCount__+=1},__endRequest(){this.$data.__requestsCount__-=1},__cwChange(source){this.$reload(source)},__queryChange(search,source){utils.isObjectExact(search)||console.error("base.__queryChange. invalid argument type");let nq=Object.assign({},this.$baseQuery);for(let p in search)search[p]?nq[p]=search[p]:delete nq[p];let mi=source?source.$ModelInfo:this.$data._findRootModelInfo();modelInfo.copyfromQuery(mi,nq),this.$reload(source)},__doInit__(baseUrl){const root=this.$data;if(!root._modelLoad_)return;let caller=null;baseUrl&&(root.__baseUrl__=baseUrl),this.$caller&&(caller=this.$caller.$data),this.__createController__(),root._modelLoad_(caller),root._seal_(root)},__createController__(){let ctrl={$save:this.$save,$invoke:this.$invoke,$close:this.$close,$modalClose:this.$modalClose,$msg:this.$msg,$alert:this.$alert,$confirm:this.$confirm,$showDialog:this.$showDialog,$inlineOpen:this.$inlineOpen,$inlineClose:this.$inlineClose,$saveModified:this.$saveModified,$asyncValid:this.$asyncValid,$toast:this.$toast,$requery:this.$requery,$reload:this.$reload,$notifyOwner:this.$notifyOwner,$navigate:this.$navigate,$defer:platform.defer,$setFilter:this.$setFilter,$expand:this.$expand,$focus:this.$focus,$report:this.$report};return Object.defineProperty(ctrl,"$isDirty",{enumerable:!0,configurable:!0,get:()=>this.$isDirty}),Object.defineProperty(ctrl,"$isPristine",{enumerable:!0,configurable:!0,get:()=>this.$isPristine}),Object.seal(ctrl),ctrl},__notified(token){token&&this.__currentToken__===token.token&&(token.toast&&this.$toast(token.toast),this.$reload(token.update||null).then((function(array){if(!token.id)return;if(!utils.isArray(array))return;let el=array.find(itm=>itm.$id===token.id);el&&el.$select&&el.$select()})))},__parseControllerAttributes(attr){if(!attr)return null;let json=JSON.parse(attr.replace(/\'/g,'"')),result={};if(json.canClose){let ccd=this.$delegate(json.canClose);ccd&&(result.canClose=ccd.bind(this.$data))}return json.alwaysOk&&(result.alwaysOk=!0),result},__isModalRequery(){let arg={url:this.$baseUrl,result:!1};return eventBus.$emit("isModalRequery",arg),arg.result},__invoke__test__(args){if("controller"!==(args=args||{}).target)return;if(this.inDialog&&args.testId!==this.__testId__)return;const root=this.$data;switch(args.action){case"eval":args.result=utils.eval(root,args.path)}},__global_period_changed__(period){this.$data._fireGlobalPeriodChanged_(period)}},created(){let out={caller:null};eventBus.$emit("registerData",this,out),this.$caller=out.caller,this.__destroyed__=!1,eventBus.$on("beginRequest",this.__beginRequest),eventBus.$on("endRequest",this.__endRequest),eventBus.$on("queryChange",this.__queryChange),eventBus.$on("childrenSaved",this.__notified),eventBus.$on("invokeTest",this.__invoke__test__),eventBus.$on("globalPeriodChanged",this.__global_period_changed__),this.$on("cwChange",this.__cwChange),this.__asyncCache__={},this.__currentToken__=window.app.nextToken(),log&&log.time("create time:",__createStartTime,!1)},beforeDestroy(){this.$data._fireUnload_()},destroyed(){this.$caller=null,eventBus.$emit("registerData",null),eventBus.$off("beginRequest",this.__beginRequest),eventBus.$off("endRequest",this.__endRequest),eventBus.$off("queryChange",this.__queryChange),eventBus.$off("childrenSaved",this.__notified),eventBus.$off("invokeTest",this.__invoke__test__),eventBus.$off("globalPeriodChanged",this.__global_period_changed__),this.$off("cwChange",this.__cwChange),htmlTools.removePrintFrame(),this.$data.$destroy&&this.$data.$destroy(),this._data=null,this.__destroyed__=!0},beforeUpdate(){__updateStartTime=performance.now()},beforeCreate(){__createStartTime=performance.now()},mounted(){let testId=this.$el.getAttribute("test-id");testId&&(this.__testId__=testId)},updated(){log&&log.time("update time:",__updateStartTime,!1)}});app.components.baseController=base}(),function(){const platform=require("std:platform"),urlTools=require("std:url");function isSeparatePage(pages,seg){return!(!seg||!pages)&&-1!==pages.indexOf(seg+",")}function findMenu(menu,func,parentMenu){if(!menu)return null;for(let i=0;i<menu.length;i++){let itm=menu[i];if(func(itm))return itm;if(itm.Menu){parentMenu&&(parentMenu.Url=itm.Url);let found=findMenu(itm.Menu,func);if(found)return platform.set(itm,"$expanded",!0),found}}return null}app.components["std:navmenu"]={findMenu,makeMenuUrl:function(menu,url,opts){opts=opts||{};let sUrl=(url=urlTools.combine(url).toLowerCase()).split("/");if(sUrl.length>=4)return url;sUrl.length;let seg1=sUrl[1];if("app"===seg1)return url;if(opts&&isSeparatePage(opts.pages,seg1))return url;let am=null;if(seg1&&(am=menu.find(mi=>mi.Url===seg1)),am){if(am&&!am.Menu)return opts.title=am.Name,url}else{let parentMenu={Url:""};if(am=findMenu(menu,mi=>mi.Url&&!mi.Menu,parentMenu),am)return opts.title=am.Name,urlTools.combine(url,parentMenu.Url,am.Url)}url=urlTools.combine(seg1);let seg2=sUrl[2];return!seg2&&opts.seg2&&(seg2=opts.seg2),am=findMenu(am.Menu,seg2?mi=>mi.Url===seg2:mi=>mi.Url&&!mi.Menu),am?(opts.title=am.Name,urlTools.combine(url,am.Url)):url},isSeparatePage}}(),function(){const locale=window.$$locale,urlTools=require("std:url"),menuTools=component("std:navmenu"),a2AppHeader={props:{title:String,subtitle:String,userState:Object,personName:String,clientId:String,userIsAdmin:Boolean,menu:Array,newMenu:Array,settingsMenu:Array,appData:Object},computed:{locale:()=>locale,seg0(){return this.$store.getters.seg0}},methods:{isActive(item){return this.seg0===item.Url},navigate(item){if(this.isActive(item))return;let storageKey="menu:"+urlTools.combine(window.$$rootUrl,item.Url),savedUrl=localStorage.getItem(storageKey)||"";savedUrl&&!menuTools.findMenu(item.Menu,mi=>mi.Url===savedUrl)&&(savedUrl="");let opts={title:null,seg2:savedUrl},url=menuTools.makeMenuUrl(this.menu,item.Url,opts);this.$store.commit("navigate",{url,title:opts.title})}}};app.components["std:appHeaderBase"]=a2AppHeader}(),function(){const store=component("std:store"),urlTools=require("std:url"),menuTools=component("std:navmenu"),htmlTools=require("std:html"),sideBar={props:{menu:Array},computed:{seg0:()=>store.getters.seg0,seg1:()=>store.getters.seg1,topMenu(){let seg0=this.seg0;return menuTools.findMenu(this.menu,mi=>mi.Url===seg0)},sideMenu(){let top=this.topMenu;return top?top.Menu:null}},methods:{isActive(item){let isActive=this.seg1===item.Url;return isActive&&htmlTools.updateDocTitle(item.Name),isActive},navigate(item){if(this.isActive(item))return;if(!item.Url)return;let top=this.topMenu;if(top){let url=urlTools.combine(top.Url,item.Url);if(-1===item.Url.indexOf("/"))try{localStorage.setItem("menu:"+urlTools.combine(window.$$rootUrl,top.Url),item.Url)}catch(e){}this.$store.commit("navigate",{url,title:item.Name})}else console.error("no top menu found")}}};app.components["std:sideBarBase"]=sideBar}(),function(){const store=component("std:store"),eventBus=require("std:eventBus"),urlTools=require("std:url"),menuTools=component("std:navmenu"),contentView={props:{menu:Array,title:String},render(h){return h("div",{attrs:{class:"main-view"}},[h("include",{props:{src:this.currentView,needReload:this.needReload}})])},computed:{currentView(){let root=window.$$rootUrl,url=store.getters.url;if("/"===url)return;let len=store.getters.len;return 2!==len&&3!==len||(url+="/index/0"),urlTools.combine(root,"/_page",url)+store.getters.search}},data:()=>({needReload:!1}),created(){var me=this;eventBus.$on("requery",(function(){me.needReload=!0,Vue.nextTick(()=>me.needReload=!1)}));let opts={title:null,pages:this.pages},menuPath=urlTools.normalizeRoot(window.location.pathname);"/home"===menuPath&&this.menu&&!this.menu.find(v=>"home"===v.Url.toLowerCase())&&(menuPath="/");let newUrl=menuTools.makeMenuUrl(this.menu,menuPath,opts);newUrl+=window.location.search,this.$store.commit("setstate",{url:newUrl,title:opts.title});let firstUrl={url:"",title:""};firstUrl.url=menuTools.makeMenuUrl(this.menu,"/",opts),firstUrl.title=opts.title,urlTools.firstUrl=firstUrl}};app.components["std:mainViewBase"]=contentView}(),function(){const store=component("std:store"),eventBus=require("std:eventBus"),shell=Vue.extend({components:{},store,data:()=>({globalPeriod:null}),computed:{seg0:()=>store.getters.seg0,seg1:()=>store.getters.seg1,fullPage(){let top=this.menu.find(x=>x.Url===this.seg0);return!(top&&null!==top.Menu&&top.Menu.length)}},watch:{},methods:{},created(){const me=this;me.__dataStack__=[],window.addEventListener("popstate",(function(event,a,b){if(eventBus.$emit("modalCloseAll"),me.__dataStack__.length>0){let comp=me.__dataStack__[0],oldUrl=event.state;if(!comp.$saveModified())return oldUrl=comp.$data.__baseUrl__.replace("/_page",""),void window.history.pushState(oldUrl,null,oldUrl)}me.$store.commit("popstate")}))}});app.components["std:shellController"]=shell}();